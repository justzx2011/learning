/** safindit - 2011/08/15  9:57:55.82 */
function prettyDate(time){if(time){time=(time.replace(/-/g,"/").replace(/T/," ")).substr(0,19)}var date=new Date(time||""),diff=(((new Date()).getTime()-date.getTime())/1000),day_diff=Math.floor(diff/86400);if(isNaN(day_diff)||day_diff<0||day_diff>=31){return"over a month ago"}return day_diff==0&&(diff<60&&"just now"||diff<120&&"1 minute ago"||diff<3600&&Math.floor(diff/60)+" minutes ago"||diff<7200&&"1 hour ago"||diff<86400&&Math.floor(diff/3600)+" hours ago")||day_diff==1&&"Yesterday"||day_diff<7&&day_diff+" days ago"||day_diff<31&&Math.ceil(day_diff/7)+" weeks ago"}var monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function formatDate(dt){if(dt){if(dt!="1970-01-01T00:00:00Z"&&dt!="2199-12-31T23:59:59Z"){var y=dt.substr(0,4);var m=monthNames[parseInt(dt.substr(5,2),10)-1];var d=dt.substr(8,2);var t=dt.substr(11,5);if(t=="00:00"||t=="23:59"){t=""}return $.trim(d+" "+m+" "+y+" "+t)}}return""}var Lawnchair=function(){if(!JSON){throw"JSON unavailable! Include http://www.json.org/json2.js to fix."}if(arguments.length<=2&&arguments.length>0){var callback=(typeof arguments[0]==="function")?arguments[0]:arguments[1],options=(typeof arguments[0]==="function")?{}:arguments[0]}else{throw"Incorrect # of ctor args!"}if(typeof callback!=="function"){throw"No callback was provided"}this.record=options.record||"record";this.name=options.name||"records";var adapter;if(options.adapter){adapter=Lawnchair.adapters[Lawnchair.adapters.indexOf(options.adapter)];adapter=adapter.valid()?adapter:undefined}else{for(var i=0,l=Lawnchair.adapters.length;i<l;i++){adapter=Lawnchair.adapters[i].valid()?Lawnchair.adapters[i]:undefined;if(adapter){break}}}if(!adapter){throw"No valid adapter."}for(var j in adapter){this[j]=adapter[j]}for(var i=0,l=Lawnchair.plugins.length;i<l;i++){Lawnchair.plugins[i].call(this)}this.init(options,callback)};Lawnchair.adapters=[];Lawnchair.adapter=function(id,obj){obj.adapter=id;var implementing="adapter valid init keys save batch get exists all remove nuke".split(" ");for(var i in obj){if(implementing.indexOf(i)===-1){throw"Invalid adapter! Nonstandard method: "+i}}Lawnchair.adapters.push(obj)};Lawnchair.plugins=[];Lawnchair.plugin=function(obj){for(var i in obj){i==="init"?Lawnchair.plugins.push(obj[i]):this.prototype[i]=obj[i]}};Lawnchair.prototype={isArray:Array.isArray||function(o){return Object.prototype.toString.call(o)==="[object Array]"},lambda:function(callback){return this.fn(this.record,callback)},fn:function(name,callback){return typeof callback=="string"?new Function(name,callback):callback},uuid:function(){var S4=function(){return(((1+Math.random())*65536)|0).toString(16).substring(1)};return(S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4())},each:function(callback){var cb=this.lambda(callback);if(this.__results){for(var i=0,l=this.__results.length;i<l;i++){cb.call(this,this.__results[i],i)}}else{this.all(function(r){for(var i=0,l=r.length;i<l;i++){cb.call(this,r[i],i)}})}return this}};Lawnchair.adapter("webkit-sqlite",(function(){var fail=function(e,i){console.log("error in sqlite adaptor!",e,i)},now=function(){return new Date()};if(!Function.prototype.bind){Function.prototype.bind=function(obj){var slice=[].slice,args=slice.call(arguments,1),self=this,nop=function(){},bound=function(){return self.apply(this instanceof nop?this:(obj||{}),args.concat(slice.call(arguments)))};nop.prototype=self.prototype;bound.prototype=new nop();return bound}}return{valid:function(){return !!(window.openDatabase)},init:function(options,callback){var that=this,cb=that.fn(that.name,callback),create="CREATE TABLE IF NOT EXISTS "+this.name+" (id NVARCHAR(32) UNIQUE PRIMARY KEY, value TEXT, timestamp REAL)",win=function(){return cb.call(that,that)};this.db=openDatabase(this.name,"1.0.0",this.name,65536);this.db.transaction(function(t){t.executeSql(create,[],win,fail)})},keys:function(callback){var cb=this.lambda(callback),that=this,keys="SELECT id FROM "+this.name+" ORDER BY timestamp DESC";this.db.transaction(function(t){var win=function(xxx,results){if(results.rows.length==0){cb.call(that,[])}else{var r=[];for(var i=0,l=results.rows.length;i<l;i++){r.push(results.rows.item(i).id)}cb.call(that,r)}};t.executeSql(keys,[],win,fail)});return this},save:function(obj,callback){var that=this,id=obj.key||that.uuid(),ins="INSERT INTO "+this.name+" (value, timestamp, id) VALUES (?,?,?)",up="UPDATE "+this.name+" SET value=?, timestamp=? WHERE id=?",win=function(){if(callback){obj.key=id;that.lambda(callback).call(that,obj)}},val=[now(),id];that.exists(obj.key,function(exists){that.db.transaction(function(t){var insert=function(obj){val.unshift(JSON.stringify(obj));t.executeSql(ins,val,win,fail)};var update=function(obj){delete (obj.key);val.unshift(JSON.stringify(obj));t.executeSql(up,val,win,fail)};exists?update(obj):insert(obj)})});return this},batch:function(objs,cb){var results=[],done=false,that=this;var updateProgress=function(obj){results.push(obj);done=results.length===objs.length};var checkProgress=setInterval(function(){if(done){if(cb){that.lambda(cb).call(that,results)}clearInterval(checkProgress)}},200);for(var i=0,l=objs.length;i<l;i++){this.save(objs[i],updateProgress)}return this},get:function(keyOrArray,cb){var that=this,sql="";if(this.isArray(keyOrArray)){sql="SELECT id, value FROM "+this.name+" WHERE id IN ('"+keyOrArray.join("','")+"')"}else{sql="SELECT id, value FROM "+this.name+" WHERE id = '"+keyOrArray+"'"}var win=function(xxx,results){var o=null,r=[];if(results.rows.length){for(var i=0,l=results.rows.length;i<l;i++){o=JSON.parse(results.rows.item(i).value);o.key=results.rows.item(i).id;r.push(o)}}if(!that.isArray(keyOrArray)){r=r.length?r[0]:null}if(cb){that.lambda(cb).call(that,r)}};this.db.transaction(function(t){t.executeSql(sql,[],win,fail)});return this},exists:function(key,cb){var is="SELECT * FROM "+this.name+" WHERE id = ?",that=this,win=function(xxx,results){if(cb){that.fn("exists",cb).call(that,(results.rows.length>0))}};this.db.transaction(function(t){t.executeSql(is,[key],win,fail)});return this},all:function(callback){var that=this,all="SELECT * FROM "+this.name,r=[],cb=this.fn(this.name,callback)||undefined,win=function(xxx,results){if(results.rows.length!=0){for(var i=0,l=results.rows.length;i<l;i++){var obj=JSON.parse(results.rows.item(i).value);obj.key=results.rows.item(i).id;r.push(obj)}}if(cb){cb.call(that,r)}};this.db.transaction(function(t){t.executeSql(all,[],win,fail)});return this},remove:function(keyOrObj,cb){var that=this,key=typeof keyOrObj==="string"?keyOrObj:keyOrObj.key,del="DELETE FROM "+this.name+" WHERE id = ?",win=function(){if(cb){that.lambda(cb).call(that)}};this.db.transaction(function(t){t.executeSql(del,[key],win,fail)});return this},nuke:function(cb){var nuke="DELETE FROM "+this.name,that=this,win=cb?function(){that.lambda(cb).call(that)}:function(){};this.db.transaction(function(t){t.executeSql(nuke,[],win,fail)});return this}}})());Lawnchair.adapter("dom",{valid:function(){return window.Storage!="undefined"},init:function(options,callback){this.storage=window.localStorage;var self=this;this.indexer={key:self.name+"._index_",all:function(){var a=JSON.parse(self.storage.getItem(this.key));if(a==null){self.storage.setItem(this.key,JSON.stringify([]))}return JSON.parse(self.storage.getItem(this.key))},add:function(key){var a=this.all();a.push(key);self.storage.setItem(this.key,JSON.stringify(a))},del:function(key){var a=this.all(),r=[];for(var i=0,l=a.length;i<l;i++){if(a[i]!=key){r.push(a[i])}}self.storage.setItem(this.key,JSON.stringify(r))},find:function(key){var a=this.all();for(var i=0,l=a.length;i<l;i++){if(key===a[i]){return i}}return false}};if(callback){this.fn(this.name,callback).call(this,this)}},save:function(obj,callback){var key=obj.key||this.uuid();if(!this.indexer.find(key)){this.indexer.add(key)}delete obj.key;this.storage.setItem(key,JSON.stringify(obj));if(callback){obj.key=key;this.lambda(callback).call(this,obj)}return this},batch:function(ary,callback){var saved=[];for(var i=0,l=ary.length;i<l;i++){this.save(ary[i],function(r){saved.push(r)})}if(callback){this.lambda(callback).call(this,saved)}return this},keys:function(){var limit=options.limit||null,offset=options.offset||0;if(callback){this.lambda(callback).call(this,this.indexer.all())}},get:function(key,callback){if(this.isArray(key)){var r=[];for(var i=0,l=key.length;i<l;i++){var obj=JSON.parse(this.storage.getItem(key[i]));if(obj){obj.key=key[i];r.push(obj)}}if(callback){this.lambda(callback).call(this,r)}}else{var obj=JSON.parse(this.storage.getItem(key));if(obj){obj.key=key}if(callback){this.lambda(callback).call(this,obj)}}return this},all:function(callback){var idx=this.indexer.all(),r=[],o;for(var i=0,l=idx.length;i<l;i++){o=JSON.parse(this.storage.getItem(idx[i]));o.key=idx[i];r.push(o)}if(callback){this.fn(this.name,callback).call(this,r)}return this},remove:function(keyOrObj,callback){var key=typeof keyOrObj==="string"?keyOrObj:keyOrObj.key;this.indexer.del(key);this.storage.removeItem(key);if(callback){this.lambda(callback).call(this)}return this},nuke:function(callback){this.all(function(r){for(var i=0,l=r.length;i<l;i++){this.remove(r[i])}if(callback){this.lambda(callback).call(this)}});return this}});if(typeof window.localStorage=="undefined"||typeof window.sessionStorage=="undefined"){(function(){var Storage=function(type){function createCookie(name,value,days){var date,expires;if(days){date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));expires="; expires="+date.toGMTString()}else{expires=""}document.cookie=name+"="+value+expires+"; path=/"}function readCookie(name){var nameEQ=name+"=",ca=document.cookie.split(";"),i,c;for(i=0;i<ca.length;i++){c=ca[i];while(c.charAt(0)==" "){c=c.substring(1,c.length)}if(c.indexOf(nameEQ)==0){return c.substring(nameEQ.length,c.length)}}return null}function setData(data){data=JSON.stringify(data);if(type=="session"){window.name=data}else{createCookie("localStorage",data,365)}}function clearData(){if(type=="session"){window.name=""}else{createCookie("localStorage","",365)}}function getData(){var data=type=="session"?window.name:readCookie("localStorage");return data?JSON.parse(data):{}}var data=getData();return{length:0,clear:function(){data={};this.length=0;clearData()},getItem:function(key){return data[key]===undefined?null:data[key]},key:function(i){var ctr=0;for(var k in data){if(ctr==i){return k}else{ctr++}}return null},removeItem:function(key){delete data[key];this.length--;setData(data)},setItem:function(key,value){data[key]=value+"";this.length++;setData(data)}}};if(typeof window.localStorage=="undefined"){window.localStorage=new Storage("local")}if(typeof window.sessionStorage=="undefined"){window.sessionStorage=new Storage("session")}})()}!function(a,b,c){function t(a,b){var c=a?c=isFinite(a.length)?a:[a]:[],d,f=b.complete,i=b.duration,k=b.easing,n=b.bezier,q=[],t=[],u=[],v=[],w=[];delete b.complete,delete b.duration,delete b.easing,delete b.bezier,n&&(delete b.right,delete b.bottom,w=[b.left||0,b.top||0],delete b.left,delete b.top);for(d=c.length;d--;){q[d]={},t[d]={},u[d]={},n&&(v[d]=n,v[d].push(w),v[d].unshift([parseInt(j(c[d],"left"),10),parseInt(j(c[d],"top"),10)]));for(var x in b){var y=j(c[d],x),z;if(typeof b[x]=="string"&&e.test(b[x])&&!e.test(y)){delete b[x];continue}q[d][x]=typeof b[x]=="string"&&e.test(b[x])?l(y).slice(1):parseFloat(y),t[d][x]=typeof b[x]=="string"&&b[x].charAt(0)=="#"?l(b[x]).slice(1):s(b[x],parseFloat(y,10)),typeof b[x]=="string"&&(z=b[x].match(g))&&(u[d][x]=z[1])}}o(i,function(a,e,f){for(d=c.length;d--;){n&&(f=p(v[d],a),c[d].style.left=f[0]+"px",c[d].style.top=f[1]+"px");for(var g in b){e=r(a,u,q,t,g,d),g=="opacity"&&!h?c[d].style.filter="alpha(opacity="+e*100+")":c[d].style[m(g)]=e}}},f,k)}function s(a,b,c,d,e){return(c=f.exec(a))?(e=parseFloat(c[2]))&&(d=b+e)&&c[1]=="+"?d:b-e:parseFloat(a)}function r(a,b,c,d,e,f,g){if(typeof c[f][e]=="string"){return q(a,c[f][e],d[f][e])}g=Math.round(((d[f][e]-c[f][e])*a+c[f][e])*1000)/1000,!(e in i)&&(g+=b[f][e]||"px");return g}function q(a,b,c){var d=[],e,f;for(e=0;e<6;e++){from=Math.min(15,parseInt(b.charAt(e),16)),to=Math.min(15,parseInt(c.charAt(e),16)),f=Math.floor((to-from)*a+from),f=f>15?15:f<0?0:f,d[e]=f.toString(16)}return"#"+d.join("")}function p(a,b){var c=a.length,d=[],e,f;for(e=0;e<c;++e){d[e]=[a[e][0],a[e][1]]}for(f=1;f<c;++f){for(e=0;e<c-f;++e){d[e][0]=(1-b)*d[e][0]+b*d[parseInt(e+1,10)][0],d[e][1]=(1-b)*d[e][1]+b*d[parseInt(e+1,10)][1]}}return[d[0][0],d[0][1]]}function o(a,b,c,d,e,f){function j(a){var k=a-i;k>g?(b(isFinite(f)?f:1),c&&c()):(isFinite(f)?b(h*d(k/g)+e):b(d(k/g)),n(j))}d=d||function(a){return Math.sin(a*Math.PI/2)};var g=a||1000,h=f-e,i=+(new Date);n(j)}var d=b.documentElement,e=/^rgb\(|#/,f=/^([+\-])=([\d\.]+)/,g=/^(?:[\+\-]=)?\d+(?:\.\d+)?(%|in|cm|mm|em|ex|pt|pc|px)$/,h=function(){return typeof b.createElement("a").style.opacity!="undefined"}(),i={lineHeight:1,zoom:1,zIndex:1,opacity:1},j=b.defaultView&&b.defaultView.getComputedStyle?function(a,c){var d=null,e=b.defaultView.getComputedStyle(a,"");e&&(d=e[m(c)]);return a.style[c]||d}:d.currentStyle?function(a,b){b=m(b);if(b=="opacity"){var c=100;try{c=a.filters["DXImageTransform.Microsoft.Alpha"].opacity}catch(d){try{c=a.filters("alpha").opacity}catch(e){}}return c/100}var f=a.currentStyle?a.currentStyle[b]:null;return a.style[b]||f}:function(a,b){return a.style[m(b)]},k=function(a,b,c){return"#"+(1<<24|a<<16|b<<8|c).toString(16).slice(1)},l=function(a){var b=/rgba?\((\d+),\s*(\d+),\s*(\d+)/.exec(a);return(b?k(b[1],b[2],b[3]):a).replace(/#(\w)(\w)(\w)$/,"#$1$1$2$2$3$3")},m=function(a){return a.replace(/-(.)/g,function(a,b){return b.toUpperCase()})},n=function(){return c.requestAnimationFrame||c.webkitRequestAnimationFrame||c.mozRequestAnimationFrame||c.oRequestAnimationFrame||c.msRequestAnimationFrame||function(a){c.setTimeout(function(){a(+(new Date))},10)}}();t.tween=o,t.getStyle=j,t.bezier=p,typeof module!="undefined"&&module.exports&&(module.exports=t),a.morpheus=t}(this,document,window);(function(){var d=true,f=null,g=false;function j(a){return function(b){this[a]=b}}function k(a){return function(){return this[a]}}var l;function m(a,b,c){this.extend(m,google.maps.OverlayView);this.b=a;this.a=[];this.m=[];this.$=[53,56,66,78,90];this.i=[];this.z=g;c=c||{};this.f=c.gridSize||60;this.V=c.maxZoom||f;this.i=c.styles||[];this.U=c.imagePath||this.O;this.T=c.imageExtension||this.N;this.M=d;if(c.zoomOnClick!=undefined){this.M=c.zoomOnClick}this.p=g;if(c.averageCenter!=undefined){this.p=c.averageCenter}n(this);this.setMap(a);this.I=this.b.getZoom();var e=this;google.maps.event.addListener(this.b,"zoom_changed",function(){var h=e.b.mapTypes[e.b.getMapTypeId()].maxZoom,o=e.b.getZoom();if(!(o<0||o>h)){if(e.I!=o){e.I=e.b.getZoom();e.k()}}});google.maps.event.addListener(this.b,"idle",function(){e.h()});b&&b.length&&this.B(b,g)}l=m.prototype;l.O="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/images/m";l.N="png";l.extend=function(a,b){return function(c){for(var e in c.prototype){this.prototype[e]=c.prototype[e]}return this}.apply(a,[b])};l.onAdd=function(){if(!this.z){this.z=d;q(this)}};l.draw=function(){};function n(a){if(!a.i.length){for(var b=0,c;c=a.$[b];b++){a.i.push({url:a.U+(b+1)+"."+a.T,height:c,width:c})}}}l.w=k("i");l.q=k("a");l.S=function(){return this.a.length};l.H=function(){return this.V||this.b.mapTypes[this.b.getMapTypeId()].maxZoom};l.F=function(a,b){for(var c=0,e=a.length,h=e;h!==0;){h=parseInt(h/10,10);c++}c=Math.min(c,b);return{text:e,index:c}};l.Y=j("F");l.G=k("F");l.B=function(a,b){for(var c=0,e;e=a[c];c++){t(this,e)}b||this.h()};function t(a,b){b.setVisible(g);b.setMap(f);b.r=g;b.draggable&&google.maps.event.addListener(b,"dragend",function(){b.r=g;a.k();a.h()});a.a.push(b)}l.o=function(a,b){t(this,a);b||this.h()};function u(a,b){var c=-1;if(a.a.indexOf){c=a.a.indexOf(b)}else{for(var e=0,h;h=a.a[e];e++){if(h==b){c=e;break}}}if(c==-1){return g}a.a.splice(c,1);b.setVisible(g);b.setMap(f);return d}l.W=function(a,b){var c=u(this,a);if(!b&&c){this.k();this.h();return d}else{return g}};l.X=function(a,b){for(var c=g,e=0,h;h=a[e];e++){h=u(this,h);c=c||h}if(!b&&c){this.k();this.h();return d}};l.R=function(){return this.m.length};l.getMap=k("b");l.setMap=j("b");l.v=k("f");l.Z=j("f");l.u=function(a){var b=this.getProjection(),c=new google.maps.LatLng(a.getNorthEast().lat(),a.getNorthEast().lng()),e=new google.maps.LatLng(a.getSouthWest().lat(),a.getSouthWest().lng());c=b.fromLatLngToDivPixel(c);c.x+=this.f;c.y-=this.f;e=b.fromLatLngToDivPixel(e);e.x-=this.f;e.y+=this.f;c=b.fromDivPixelToLatLng(c);b=b.fromDivPixelToLatLng(e);a.extend(c);a.extend(b);return a};l.P=function(){this.k();this.a=[]};l.k=function(){for(var a=0,b;b=this.m[a];a++){b.remove()}for(a=0;b=this.a[a];a++){b.r=g;b.setMap(f);b.setVisible(g)}this.m=[]};l.h=function(){q(this)};function q(a){if(a.z){for(var b=a.u(new google.maps.LatLngBounds(a.b.getBounds().getSouthWest(),a.b.getBounds().getNorthEast())),c=0,e;e=a.a[c];c++){if(!e.r&&b.contains(e.getPosition())){var h=a;e=e;for(var o=40000,r=f,x=0,p=void 0;p=h.m[x];x++){var i=p.getCenter();if(i){i=i;var s=e.getPosition();if(!i||!s){i=0}else{var y=(s.lat()-i.lat())*Math.PI/180,z=(s.lng()-i.lng())*Math.PI/180;i=Math.sin(y/2)*Math.sin(y/2)+Math.cos(i.lat()*Math.PI/180)*Math.cos(s.lat()*Math.PI/180)*Math.sin(z/2)*Math.sin(z/2);i=6371*2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))}if(i<o){o=i;r=p}}}if(r&&r.D.contains(e.getPosition())){r.o(e)}else{p=new v(h);p.o(e);h.m.push(p)}}}}}function v(a){this.j=a;this.b=a.getMap();this.f=a.v();this.p=a.p;this.d=f;this.a=[];this.D=f;this.l=new w(this,a.w(),a.v())}l=v.prototype;l.o=function(a){var b;a:if(this.a.indexOf){b=this.a.indexOf(a)!=-1}else{b=0;for(var c;c=this.a[b];b++){if(c==a){b=d;break a}}b=g}if(b){return g}if(this.d){if(this.p){c=this.a.length+1;b=(this.d.lat()*(c-1)+a.getPosition().lat())/c;c=(this.d.lng()*(c-1)+a.getPosition().lng())/c;this.d=new google.maps.LatLng(b,c);A(this)}}else{this.d=a.getPosition();A(this)}if(this.a.length==0){a.setMap(this.b);a.setVisible(d)}else{if(this.a.length==1){this.a[0].setMap(f);this.a[0].setVisible(g)}}a.r=d;this.a.push(a);if(this.b.getZoom()>this.j.H()){for(a=0;b=this.a[a];a++){b.setMap(this.b);b.setVisible(d)}}else{if(this.a.length<2){B(this.l)}else{b=this.j.G()(this.a,this.j.w().length);this.l.setCenter(this.d);a=this.l;a.A=b;a.ca=b.text;a.aa=b.index;if(a.c){a.c.innerHTML=b.text}b=Math.max(0,a.A.index-1);b=Math.min(a.i.length-1,b);b=a.i[b];a.L=b.url;a.g=b.height;a.n=b.width;a.J=b.textColor;a.e=b.anchor;a.K=b.textSize;a.C=b.backgroundPosition;this.l.show()}}return d};l.getBounds=function(){for(var a=new google.maps.LatLngBounds(this.d,this.d),b=this.q(),c=0,e;e=b[c];c++){a.extend(e.getPosition())}return a};l.remove=function(){this.l.remove();this.a.length=0;delete this.a};l.Q=function(){return this.a.length};l.q=k("a");l.getCenter=k("d");function A(a){a.D=a.j.u(new google.maps.LatLngBounds(a.d,a.d))}l.getMap=k("b");function w(a,b,c){a.j.extend(w,google.maps.OverlayView);this.i=b;this.ba=c||0;this.t=a;this.d=f;this.b=a.getMap();this.A=this.c=f;this.s=g;this.setMap(this.b)}l=w.prototype;l.onAdd=function(){this.c=document.createElement("DIV");if(this.s){this.c.style.cssText=C(this,D(this,this.d));this.c.innerHTML=this.A.text}this.getPanes().overlayImage.appendChild(this.c);var a=this;google.maps.event.addDomListener(this.c,"click",function(){var b=a.t.j;google.maps.event.trigger(b,"clusterclick",a.t);b.M&&a.b.fitBounds(a.t.getBounds())})};function D(a,b){var c=a.getProjection().fromLatLngToDivPixel(b);c.x-=parseInt(a.n/2,10);c.y-=parseInt(a.g/2,10);return c}l.draw=function(){if(this.s){var a=D(this,this.d);this.c.style.top=a.y+"px";this.c.style.left=a.x+"px"}};function B(a){if(a.c){a.c.style.display="none"}a.s=g}l.show=function(){if(this.c){this.c.style.cssText=C(this,D(this,this.d));this.c.style.display=""}this.s=d};l.remove=function(){this.setMap(f)};l.onRemove=function(){if(this.c&&this.c.parentNode){B(this);this.c.parentNode.removeChild(this.c);this.c=f}};l.setCenter=j("d");function C(a,b){var c=[];if(document.all){c.push('filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale,src="'+a.L+'");')}else{c.push("background-image:url("+a.L+");");c.push("background-position:"+(a.C?a.C:"0 0")+";")}if(typeof a.e==="object"){typeof a.e[0]==="number"&&a.e[0]>0&&a.e[0]<a.g?c.push("height:"+(a.g-a.e[0])+"px; padding-top:"+a.e[0]+"px;"):c.push("height:"+a.g+"px; line-height:"+a.g+"px;");typeof a.e[1]==="number"&&a.e[1]>0&&a.e[1]<a.n?c.push("width:"+(a.n-a.e[1])+"px; padding-left:"+a.e[1]+"px;"):c.push("width:"+a.n+"px; text-align:center;")}else{c.push("height:"+a.g+"px; line-height:"+a.g+"px; width:"+a.n+"px; text-align:center;")}c.push("cursor:pointer; top:"+b.y+"px; left:"+b.x+"px; color:"+(a.J?a.J:"black")+"; position:absolute; font-size:"+(a.K?a.K:11)+"px; font-family:Arial,sans-serif; font-weight:bold");return c.join("")}window.MarkerClusterer=m;m.prototype.addMarker=m.prototype.o;m.prototype.addMarkers=m.prototype.B;m.prototype.clearMarkers=m.prototype.P;m.prototype.getCalculator=m.prototype.G;m.prototype.getGridSize=m.prototype.v;m.prototype.getExtendedBounds=m.prototype.u;m.prototype.getMap=m.prototype.getMap;m.prototype.getMarkers=m.prototype.q;m.prototype.getMaxZoom=m.prototype.H;m.prototype.getStyles=m.prototype.w;m.prototype.getTotalClusters=m.prototype.R;m.prototype.getTotalMarkers=m.prototype.S;m.prototype.redraw=m.prototype.h;m.prototype.removeMarker=m.prototype.W;m.prototype.removeMarkers=m.prototype.X;m.prototype.resetViewport=m.prototype.k;m.prototype.setCalculator=m.prototype.Y;m.prototype.setGridSize=m.prototype.Z;m.prototype.onAdd=m.prototype.onAdd;m.prototype.draw=m.prototype.draw;v.prototype.getCenter=v.prototype.getCenter;v.prototype.getSize=v.prototype.Q;v.prototype.getMarkers=v.prototype.q;w.prototype.onAdd=w.prototype.onAdd;w.prototype.draw=w.prototype.draw;w.prototype.onRemove=w.prototype.onRemove})();(function(){var d=!1,g=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.SimpleClass=function(){};SimpleClass.extend=function(b){function c(){!d&&this.init&&this.init.apply(this,arguments)}var e=this.prototype;d=!0;var f=new this;d=!1;for(var a in b){f[a]=typeof b[a]=="function"&&typeof e[a]=="function"&&g.test(b[a])?function(a,b){return function(){var c=this._super;this._super=e[a];var d=b.apply(this,arguments);this._super=c;return d}}(a,b[a]):b[a]}c.prototype=f;c.constructor=c;c.extend=arguments.callee;return c}})();(function(){if(!Function.prototype.bind){Function.prototype.bind=function(a){var b=[].slice,d=b.call(arguments,1),e=this,c=function(){},f=function(){return e.apply(this instanceof c?this:a||{},d.concat(b.call(arguments)))};c.prototype=e.prototype;f.prototype=new c;return f}}if(typeof Code==="undefined"){Code={},Code.PhotoSwipe={}}Code.PhotoSwipe.Util={browser:{version:(navigator.userAgent.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1],webkit:/webkit/i.test(navigator.userAgent),opera:/opera/i.test(navigator.userAgent),msie:/msie/i.test(navigator.userAgent)&&!/opera/.test(navigator.userAgent),chrome:/Chrome/i.test(navigator.userAgent),mozilla:/mozilla/i.test(navigator.userAgent)&&!/(compatible|webkit)/.test(navigator.userAgent),mobileSafari:/mobile.*safari/i.test(navigator.userAgent),is3dSupported:!1,isAndroid:/android/i.test(navigator.userAgent),isBlackberry:/blackberry/i.test(navigator.userAgent),isiOS:/like Mac OS/i.test(navigator.userAgent),touchSupported:!1,gestureSupported:!1,_eventTagNames:{select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"},isEventSupported:function(a){var b=document.createElement(this._eventTagNames[a]||"div"),a="on"+a,d=a in b;d||(b.setAttribute(a,"return;"),d=typeof b[a]=="function");return d}},setElementData:function(a,b,d){if(this.isNothing(a.UtilData)){a.UtilData={}}a.UtilData[b]=d},getElementData:function(a,b,d){typeof d==="undefined"&&(d=null);if(this.isNothing(a.UtilData)){return d}if(this.isNothing(a.UtilData[b])){return d}return a.UtilData[b]},removeElementData:function(a,b){delete a.UtilData[b]},coalesce:function(){var a;for(a=0;a<arguments.length;a++){if(!this.isNothing(arguments[a])){return arguments[a]}}return null},registerNamespace:function(){var a=arguments,b=null,d,e;for(d=0;d<a.length;++d){var c=a[d].split(".");e=c[0];eval("if (typeof "+e+' == "undefined"){'+e+" = {};} obj = "+e+";");for(e=1;e<c.length;++e){b[c[e]]=b[c[e]]||{},b=b[c[e]]}}},extend:function(a,b,d){this.isNothing(d)&&(d=!0);if(a&&b&&this.isObject(b)){for(var e in b){d?a[e]=b[e]:typeof a[e]=="undefined"&&(a[e]=b[e])}}},swapArrayElements:function(a,b,d){var e=a[b];a[b]=a[d];a[d]=e},isObject:function(a){return typeof a=="object"},isNothing:function(a){if(typeof a==="undefined"||a===null){return !0}return !1},isFunction:function(a){return typeof a=="function"},isArray:function(a){return a&&Code.PhotoSwipe.Util.isFunction(a.pop)},isNumber:function(a){return typeof a=="number"},isString:function(a){return typeof a=="string"},trim:function(a){return a.replace(RegExp(/\s+?/),"")}};if(Code.PhotoSwipe.Util.browser.webkit&&!Code.PhotoSwipe.Util.browser.chrome){var c=document.createElement("div");Code.PhotoSwipe.Util.browser.is3dSupported=!Code.PhotoSwipe.Util.isNothing(c.style.WebkitPerspective)}Code.PhotoSwipe.Util.browser.touchSupported=Code.PhotoSwipe.Util.browser.isEventSupported("touchstart");Code.PhotoSwipe.Util.browser.gestureSupported=Code.PhotoSwipe.Util.browser.isEventSupported("gesturestart")})(window);(function(c,a){a.extend(a,{DOM:{resetTranslate:function(b){a.browser.webkit?a.browser.is3dSupported?$(b).css({webkitTransform:"translate3d(0px, 0px, 0px)"}):$(b).css({webkitTransform:"translate(0px, 0px)"}):$(b).css({webkitTransform:"translate(0px, 0px)",MozTransform:"translate(0px, 0px)",transform:"translate(0px, 0px)"})},createElement:function(a,d,e){a=$("<"+a+"></"+a+">");a.attr(d);a.append(e);return a[0]},appendChild:function(a,d){$(d).append(a)},appendText:function(a,d){$(d).text(a)},appendToBody:function(a){$("body").append(a)},removeChild:function(a){$(a).empty().remove()},removeChildren:function(a){$(a).empty()},hasAttribute:function(b,d){return a.isNothing($(b).attr(d))},getAttribute:function(a,d){return $(a).attr(d)},setAttribute:function(a,d,e){$(a).attr(d,e)},removeAttribute:function(a,d){$(a).removeAttr(d)},addClass:function(a,d){$(a).addClass(d)},removeClass:function(a,d){$(a).removeClass(d)},hasClass:function(a,d){$(a).hasClass(d)},setStyle:function(b,d,e){a.isObject(d)?$(b).css(d):$(b).css(d,e)},getStyle:function(a,d){return $(a).css(d)},hide:function(a){$(a).hide()},show:function(a){$(a).show()},width:function(b,d){a.isNothing(d)||$(b).width(d);return $(b).width()},outerWidth:function(a){return $(a).outerWidth()},height:function(b,d){a.isNothing(d)||$(b).height(d);return $(b).height()},outerHeight:function(a){return $(a).outerHeight()},documentWidth:function(){return $(document.documentElement).width()},documentHeight:function(){return $(document.documentElement).height()},bodyWidth:function(){return $(document.body).width()},bodyHeight:function(){return $(document.body).height()},windowWidth:function(){if(!c.innerWidth){return $(c).width()}return c.innerWidth},windowHeight:function(){if(!c.innerHeight){return $(c).height()}return c.innerHeight},windowScrollLeft:function(){if(!c.pageXOffset){return $(c).scrollLeft()}return c.pageXOffset},windowScrollTop:function(){if(!c.pageYOffset){return $(c).scrollTop()}return c.pageYOffset},addEventListener:function(a,d,e){$(a).bind(d,e)},removeEventListener:function(a,d,e){$(a).unbind(d,e)},getMousePosition:function(a){return{x:a.pageX,y:a.pageY}},getTouchEvent:function(a){return a.originalEvent}}})})(window,Code.PhotoSwipe.Util);(function(c,a){a.extend(a,{Animation:{stopFade:function(a){$(a).stop(!0,!0)},fadeIn:function(b,d,e,c){d=a.coalesce(d,1);e=a.coalesce(e,500);$(b).fadeTo(e,d,c)},fadeOut:function(b,d,e){a.isNothing(d)&&(d=500);$(b).fadeTo(d,0,e)},slideBy:function(b,d,e,c,f){a.isNothing(c)&&(c=500);d=jQuery.fn.translation?{left:"+="+d+"px",top:"+="+e+"px",useTranslate3d:a.browser.is3dSupported}:{left:"+="+d+"px",top:"+="+e+"px"};$(b).animate(d,c,f)}}})})(window,Code.PhotoSwipe.Util);(function(){Code.PhotoSwipe.EventClass=SimpleClass.extend({_listeners:null,init:function(){this._listeners={}},addEventListener:function(c,a){typeof this._listeners[c]==="undefined"&&(this._listeners[c]=[]);this._listeners[c].push(a)},dispatchEvent:function(c){typeof c=="string"&&(c={type:c});if(!c.target){c.target=this}if(!c.type){throw Error("Event object missing 'type' property.")}if(this._listeners[c.type] instanceof Array){for(var a=this._listeners[c.type],b=0,d=a.length;b<d;b++){a[b].call(this,c)}}},removeEventListener:function(c,a){if(this._listeners[c] instanceof Array){for(var b=this._listeners[c],d=0,e=b.length;d<e;d++){if(b[d]===a){b.splice(d,1);break}}}}})})();(function(c,a){Code.PhotoSwipe.ElementClass=Code.PhotoSwipe.EventClass.extend({el:null,settings:null,isHidden:null,fadeInHandler:null,fadeOutHandler:null,init:function(b){this._super();this.settings={opacity:1,fadeInSpeed:250,fadeOutSpeed:500};a.extend(this.settings,b);this.fadeInHandler=this.postFadeIn.bind(this);this.fadeOutHandler=this.postFadeOut.bind(this);this.isHidden=!0},resetPosition:function(){},show:function(){this.stopFade();a.DOM.setStyle(this.el,"opacity",this.settings.opacity);a.DOM.show(this.el);this.postShow()},postShow:function(){this.isHidden=!1;this.addEventListeners();this.dispatchEvent(Code.PhotoSwipe.ElementClass.EventTypes.onShow)},fadeIn:function(){a.DOM.setStyle(this.el,"opacity",0);this.fadeInFromCurrentOpacity()},fadeInFromCurrentOpacity:function(){this.stopFade();this.isHidden=!1;a.DOM.show(this.el);a.Animation.fadeIn(this.el,this.settings.opacity,this.settings.fadeInSpeed,this.fadeInHandler)},postFadeIn:function(){this.isHidden||(this.addEventListeners(),this.dispatchEvent(Code.PhotoSwipe.ElementClass.EventTypes.onFadeIn))},hide:function(){this.stopFade();a.DOM.hide(this.el);this.postHide()},postHide:function(){this.isHidden=!0;this.removeEventListeners();this.dispatchEvent(Code.PhotoSwipe.ElementClass.EventTypes.onHide)},fadeOut:function(){this.stopFade();this.isHidden=!0;a.Animation.fadeOut(this.el,this.settings.fadeOutSpeed,this.fadeOutHandler)},postFadeOut:function(){this.isHidden&&(a.DOM.hide(this.el),this.removeEventListeners(),this.dispatchEvent(Code.PhotoSwipe.ElementClass.EventTypes.onFadeOut))},stopFade:function(){a.Animation.stopFade(this.el)},addEventListeners:function(){},removeEventListeners:function(){}});Code.PhotoSwipe.ElementClass.EventTypes={onShow:"onShow",onHide:"onHide",onClick:"onClick",onFadeIn:"onFadeIn",onFadeOut:"onFadeOut"}})(window,Code.PhotoSwipe.Util);(function(c,a){Code.PhotoSwipe.FullSizeImageClass=Code.PhotoSwipe.EventClass.extend({el:null,index:null,naturalWidth:null,naturalHeight:null,src:null,caption:null,metaData:null,scaleMethod:null,isLandscape:null,isLoading:null,hasLoaded:null,loadEventHandler:null,init:function(b,d,e,c,f){this._super();this.index=b;this.naturalHeight=this.naturalWidth=0;this.src=e;this.caption=c;this.metaData=a.coalesce(f,{});this.hasLoaded=this.isLoading=this.isLandscape=!1;this.scaleMethod=d;this.loadEventHandler=this.onLoad.bind(this)},load:function(){this.isLoading=!0;this.el=new Image;a.DOM.addClass(this.el,"ps-full-size-image");this.el.onload=this.loadEventHandler;this.el.src=this.src},onLoad:function(){this.naturalWidth=a.coalesce(this.el.naturalWidth,this.el.width);this.naturalHeight=a.coalesce(this.el.naturalHeight,this.el.height);this.isLandscape=this.naturalWidth>this.naturalHeight;this.isLoading=!1;this.hasLoaded=!0;this.dispatchEvent(Code.PhotoSwipe.FullSizeImageClass.EventTypes.onLoad)}});Code.PhotoSwipe.FullSizeImageClass.EventTypes={onLoad:"onLoad"}})(window,Code.PhotoSwipe.Util);(function(c,a){Code.PhotoSwipe.DocumentOverlayClass=Code.PhotoSwipe.ElementClass.extend({init:function(b){this.settings={zIndex:1000};a.extend(this.settings,b);this._super(b);this.el=a.DOM.createElement("div",{"class":Code.PhotoSwipe.DocumentOverlayClass.CssClasses.documentOverlay},"");a.DOM.setStyle(this.el,{left:0,position:"absolute",zIndex:this.settings.zIndex,top:0});a.DOM.hide(this.el);a.DOM.appendToBody(this.el)},resetPosition:function(){a.DOM.width(this.el,a.DOM.bodyWidth());a.DOM.height(this.el,a.DOM.bodyHeight())}});Code.PhotoSwipe.DocumentOverlayClass.CssClasses={documentOverlay:"ps-document-overlay"}})(window,Code.PhotoSwipe.Util);(function(c,a){Code.PhotoSwipe.ViewportClass=Code.PhotoSwipe.ElementClass.extend({touchStartPoint:null,touchStartTime:null,touchStartHandler:null,touchMoveHandler:null,touchEndHandler:null,gestureStartHandler:null,gestureChangeHandler:null,gestureEndHandler:null,isGesture:null,mouseDownHandler:null,mouseUpHandler:null,init:function(b){this.settings={swipeThreshold:500,swipeTimeThreshold:250,zIndex:1000};a.extend(this.settings,b);this._super(this.settings);this.touchStartPoint={x:0,y:0};if(a.browser.touchSupported){this.touchStartHandler=this.onTouchStart.bind(this),this.touchMoveHandler=this.onTouchMove.bind(this),this.touchEndHandler=this.onTouchEnd.bind(this)}if(a.browser.gestureSupported){this.gestureStartHandler=this.onGestureStart.bind(this),this.gestureChangeHandler=this.onGestureChange.bind(this),this.gestureEndHandler=this.onGestureEnd.bind(this)}this.mouseDownHandler=this.onMouseDown.bind(this);this.mouseUpHandler=this.onMouseUp.bind(this);this.el=a.DOM.createElement("div",{"class":Code.PhotoSwipe.ViewportClass.CssClasses.viewport,"data-role":"dialog"},"");a.DOM.setStyle(this.el,{position:"absolute",left:0,zIndex:this.settings.zIndex,overflow:"hidden"});a.DOM.hide(this.el);a.DOM.appendToBody(this.el)},resetPosition:function(){a.DOM.setStyle(this.el,{top:a.DOM.windowScrollTop()+"px"});a.DOM.width(this.el,a.DOM.bodyWidth());a.DOM.height(this.el,a.DOM.windowHeight())},addEventListeners:function(){a.browser.touchSupported&&(a.DOM.addEventListener(this.el,"touchstart",this.touchStartHandler),a.DOM.addEventListener(this.el,"touchmove",this.touchMoveHandler),a.DOM.addEventListener(this.el,"touchend",this.touchEndHandler));a.browser.gestureSupported&&(a.DOM.addEventListener(this.el,"gesturestart",this.gestureStartHandler),a.DOM.addEventListener(this.el,"gesturechange",this.gestureChangeHandler),a.DOM.addEventListener(this.el,"gestureend",this.gestureEndHandler));a.DOM.addEventListener(this.el,"mousedown",this.mouseDownHandler);a.DOM.addEventListener(this.el,"mouseup",this.mouseUpHandler)},removeEventListeners:function(){a.browser.touchSupported&&(a.DOM.removeEventListener(this.el,"touchstart",this.touchStartHandler),a.DOM.removeEventListener(this.el,"touchmove",this.touchMoveHandler),a.DOM.removeEventListener(this.el,"touchend",this.touchEndHandler));a.browser.gestureSupported&&(a.DOM.removeEventListener(this.el,"gesturestart",this.gestureStartHandler),a.DOM.removeEventListener(this.el,"gesturechange",this.gestureChangeHandler),a.DOM.removeEventListener(this.el,"gestureend",this.gestureEndHandler));a.DOM.removeEventListener(this.el,"mousedown",this.mouseDownHandler);a.DOM.removeEventListener(this.el,"mouseup",this.mouseUpHandler)},getTouchPoint:function(a){return{x:a[0].pageX,y:a[0].pageY}},onGestureStart:function(b){b.preventDefault();b=a.DOM.getTouchEvent(b);this.dispatchEvent({type:Code.PhotoSwipe.ViewportClass.EventTypes.onTouch,target:this,action:Code.PhotoSwipe.ViewportClass.Actions.gestureStart,scale:b.scale,rotation:b.rotation})},onGestureChange:function(b){b.preventDefault();b=a.DOM.getTouchEvent(b);this.dispatchEvent({type:Code.PhotoSwipe.ViewportClass.EventTypes.onTouch,target:this,action:Code.PhotoSwipe.ViewportClass.Actions.gestureChange,scale:b.scale,rotation:b.rotation})},onGestureEnd:function(b){b.preventDefault();b=a.DOM.getTouchEvent(b);this.dispatchEvent({type:Code.PhotoSwipe.ViewportClass.EventTypes.onTouch,target:this,action:Code.PhotoSwipe.ViewportClass.Actions.gestureEnd,scale:b.scale,rotation:b.rotation})},onTouchStart:function(b){b.preventDefault();b=a.DOM.getTouchEvent(b).touches;b.length>1?this.isGesture=!0:(this.dispatchEvent({type:Code.PhotoSwipe.ViewportClass.EventTypes.onTouch,target:this,action:Code.PhotoSwipe.ViewportClass.Actions.touchStart,point:this.getTouchPoint(b)}),this.touchStartTime=new Date,this.isGesture=!1,this.touchStartPoint=this.getTouchPoint(b))},onTouchMove:function(b){b.preventDefault();if(!this.isGesture){b=a.DOM.getTouchEvent(b).touches,this.dispatchEvent({type:Code.PhotoSwipe.ViewportClass.EventTypes.onTouch,target:this,action:Code.PhotoSwipe.ViewportClass.Actions.touchMove,point:this.getTouchPoint(b)})}},onTouchEnd:function(b){b.preventDefault();this.isGesture||(b=a.DOM.getTouchEvent(b),b=this.getTouchPoint(!a.isNothing(b.changedTouches)?b.changedTouches:b.touches),this.dispatchEvent({type:Code.PhotoSwipe.ViewportClass.EventTypes.onTouch,target:this,action:Code.PhotoSwipe.ViewportClass.Actions.touchEnd,point:b}),this.fireTouchEvent(this.touchStartPoint,b))},onMouseDown:function(b){b.preventDefault();this.touchStartTime=new Date;this.isGesture=!1;this.touchStartPoint=a.DOM.getMousePosition(b)},onMouseUp:function(b){b.preventDefault();this.fireTouchEvent(this.touchStartPoint,a.DOM.getMousePosition(b))},fireTouchEvent:function(b,d){var e;new Date-this.touchStartTime>this.settings.swipeTimeThreshold||(e=d.x-b.x,e=Math.abs(e)>=this.settings.swipeThreshold?e<0?Code.PhotoSwipe.ViewportClass.Actions.swipeLeft:Code.PhotoSwipe.ViewportClass.Actions.swipeRight:Code.PhotoSwipe.ViewportClass.Actions.click,a.isNothing(e)||this.dispatchEvent({type:Code.PhotoSwipe.ViewportClass.EventTypes.onTouch,target:this,action:e}))}});Code.PhotoSwipe.ViewportClass.CssClasses={viewport:"ps-viewport"};Code.PhotoSwipe.ViewportClass.Actions={click:"click",swipeLeft:"swipeLeft",swipeRight:"swipeRight",touchStart:"touchStart",touchMove:"touchMove",touchEnd:"touchEnd",gestureStart:"gestureStart",gestureChange:"gestureChange",gestureEnd:"gestureEnd"};Code.PhotoSwipe.ViewportClass.EventTypes={onTouch:"onTouch"}})(window,Code.PhotoSwipe.Util);(function(c,a,b){Code.PhotoSwipe.SliderItemClass=Code.PhotoSwipe.EventClass.extend({el:null,imageContainerEl:null,imageEl:null,parentEl:null,fullSizeImage:null,fullSizeImageLoadEventHandler:null,savedImageWidth:null,savedImageHeight:null,init:function(b){this._super();this.parentEl=b;this.fullSizeImageLoadEventHandler=this.onFullSizeImageLoad.bind(this);this.el=a.DOM.createElement("div",{"class":Code.PhotoSwipe.SliderItemClass.CssClasses.item+" "+Code.PhotoSwipe.SliderItemClass.CssClasses.loading},"");a.DOM.setStyle(this.el,{position:"absolute",overflow:"hidden",top:0});a.DOM.resetTranslate(this.el);a.DOM.appendChild(this.el,this.parentEl);this.imageContainerEl=a.DOM.createElement("div");a.DOM.setStyle(this.imageContainerEl,{position:"absolute",overflow:"hidden",top:0,left:0});a.DOM.appendChild(this.imageContainerEl,this.el);this.imageEl=new Image;a.DOM.setStyle(this.imageEl,{display:"block",position:"absolute",margin:0,padding:0});a.DOM.hide(this.imageEl);a.DOM.appendChild(this.imageEl,this.imageContainerEl)},resetPosition:function(b,e,c){a.DOM.width(this.el,b);a.DOM.height(this.el,e);a.DOM.setStyle(this.el,"left",c+"px");a.DOM.width(this.imageContainerEl,b);a.DOM.height(this.imageContainerEl,e);this.resetImagePosition()},resetImagePosition:function(){if(!a.isNothing(this.fullSizeImage)){a.DOM.getAttribute(this.imageEl,"src");var b,e,c,f;f=a.DOM.width(this.el);var h=a.DOM.height(this.el);b=this.fullSizeImage.isLandscape?f/this.fullSizeImage.naturalWidth:h/this.fullSizeImage.naturalHeight;e=Math.round(this.fullSizeImage.naturalWidth*b);c=Math.round(this.fullSizeImage.naturalHeight*b);this.fullSizeImage.scaleMethod==="zoom"?(b=1,c<h?b=h/c:e<f&&(b=f/e),b!==1&&(e=Math.round(e*b),c=Math.round(c*b))):this.fullSizeImage.scaleMethod==="fit"&&(b=1,e>f?b=f/e:c>h&&(b=h/c),b!==1&&(e=Math.round(e*b),c=Math.round(c*b)));b=(h-c)/2+"px";f=(f-e)/2+"px";a.DOM.width(this.imageEl,e);a.DOM.height(this.imageEl,c);a.DOM.setStyle(this.imageEl,{top:b,left:f});a.DOM.show(this.imageEl);this.savedImageWidth=e;this.savedImageHeight=c}},setFullSizeImage:function(d){this.fullSizeImage=d;a.DOM.removeClass(this.el,Code.PhotoSwipe.SliderItemClass.CssClasses.loading);a.DOM.removeClass(this.el,Code.PhotoSwipe.SliderItemClass.CssClasses.imageError);a.isNothing(this.fullSizeImage)?(this.fullSizeImage=null,a.DOM.addClass(this.el,Code.PhotoSwipe.SliderItemClass.CssClasses.imageError),this.hideImage()):this.fullSizeImage.hasLoaded?(a.DOM.setAttribute(this.imageEl,"src",this.fullSizeImage.src),this.resetImagePosition(),this.dispatchEvent(Code.PhotoSwipe.SliderItemClass.EventTypes.onFullSizeImageDisplay)):(a.DOM.addClass(this.el,Code.PhotoSwipe.SliderItemClass.CssClasses.loading),this.hideImage(),this.fullSizeImage.isLoading||(this.fullSizeImage.addEventListener(b.EventTypes.onLoad,this.fullSizeImageLoadEventHandler),this.fullSizeImage.load()))},onFullSizeImageLoad:function(d){d.target.removeEventListener(b.EventTypes.onLoad,this.fullSizeImageLoadEventHandler);a.isNothing(this.fullSizeImage)||d.target.index!==this.fullSizeImage.index?this.dispatchEvent({type:Code.PhotoSwipe.SliderItemClass.EventTypes.onFullSizeImageLoadAnomaly,target:this,fullSizeImage:d.target}):this.setFullSizeImage(d.target)},hideImage:function(){a.DOM.removeAttribute(this.imageEl,"src");a.DOM.hide(this.imageEl)}});Code.PhotoSwipe.SliderItemClass.CssClasses={item:"ps-slider-item",loading:"ps-slider-item-loading",imageError:"ps-slider-item-image-error"};Code.PhotoSwipe.SliderItemClass.EventTypes={onFullSizeImageDisplay:"onFullSizeImageDisplay",onFullSizeImageLoadAnomaly:"onFullSizeImageLoadAnomaly"}})(window,Code.PhotoSwipe.Util,Code.PhotoSwipe.FullSizeImageClass);(function(c,a,b){Code.PhotoSwipe.SliderClass=Code.PhotoSwipe.ElementClass.extend({parentEl:null,parentElWidth:null,parentElHeight:null,items:null,scaleEl:null,lastScaleValue:null,previousItem:null,currentItem:null,nextItem:null,hasBounced:null,lastShowAction:null,bounceSlideBy:null,showNextEndEventHandler:null,showPreviousEndEventHandler:null,bounceStepOneEventHandler:null,bounceStepTwoEventHandler:null,sliderFullSizeImageLoadAnomalyEventHandler:null,init:function(d,c){this.settings={slideSpeed:250};a.extend(this.settings,d);this._super(this.settings);this.parentEl=c;this.hasBounced=!1;this.showNextEndEventHandler=this.onShowNextEnd.bind(this);this.showPreviousEndEventHandler=this.onShowPreviousEnd.bind(this);this.bounceStepOneEventHandler=this.onBounceStepOne.bind(this);this.bounceStepTwoEventHandler=this.onBounceStepTwo.bind(this);this.sliderFullSizeImageLoadAnomalyEventHandler=this.onSliderFullSizeImageLoadAnomaly.bind(this);this.el=a.DOM.createElement("div",{"class":Code.PhotoSwipe.SliderClass.CssClasses.slider},"");a.DOM.setStyle(this.el,{position:"absolute",top:0});a.DOM.hide(this.el);a.DOM.appendChild(this.el,c);this.items=[];this.items.push(new b(this.el));this.items.push(new b(this.el));this.items.push(new b(this.el));this.previousItem=this.items[0];this.currentItem=this.items[1];this.nextItem=this.items[2]},addEventListeners:function(){for(var a=0;a<this.items.length;a++){this.items[a].addEventListener(b.EventTypes.onFullSizeImageLoadAnomaly,this.sliderFullSizeImageLoadAnomalyEventHandler)}},removeEventListeners:function(){for(var a=0;a<this.items.length;a++){this.items[a].removeEventListener(b.EventTypes.onFullSizeImageLoadAnomaly,this.sliderFullSizeImageLoadAnomalyEventHandler)}},resetPosition:function(){a.DOM.show(this.currentItem.imageContainerEl);this.parentElWidth=a.DOM.width(this.parentEl);this.parentElHeight=a.DOM.height(this.parentEl);a.DOM.width(this.el,this.parentElWidth*3);a.DOM.height(this.el,this.parentElHeight);this.previousItem.resetPosition(this.parentElWidth,this.parentElHeight,0);this.currentItem.resetPosition(this.parentElWidth,this.parentElHeight,this.parentElWidth);this.nextItem.resetPosition(this.parentElWidth,this.parentElHeight,this.parentElWidth*2);this.center()},center:function(){a.DOM.resetTranslate(this.el);a.DOM.setStyle(this.el,{left:this.parentElWidth*-1+"px"})},setCurrentFullSizeImage:function(a){this.currentItem.setFullSizeImage(a);this.dispatchDisplayCurrentFullSizeImage()},setPreviousAndNextFullSizeImages:function(a,b){this.nextItem.setFullSizeImage(b);this.previousItem.setFullSizeImage(a)},showNext:function(){this.lastShowAction=Code.PhotoSwipe.SliderClass.ShowActionTypes.next;this.hasBounced=!1;a.isNothing(this.nextItem.fullSizeImage)?this.bounce():a.Animation.slideBy(this.el,this.parentElWidth*-1,0,this.settings.slideSpeed,this.showNextEndEventHandler)},showPrevious:function(){this.lastShowAction=Code.PhotoSwipe.SliderClass.ShowActionTypes.previous;this.hasBounced=!1;a.isNothing(this.previousItem.fullSizeImage)?this.bounce():a.Animation.slideBy(this.el,this.parentElWidth,0,this.settings.slideSpeed,this.showPreviousEndEventHandler)},bounce:function(){a.DOM.show(this.currentItem.imageContainerEl);this.hasBounced=!0;a.browser.chrome?this.dispatchDisplayCurrentFullSizeImage():(this.bounceSlideBy=this.parentElWidth/2,a.Animation.slideBy(this.el,this.lastShowAction===Code.PhotoSwipe.SliderClass.ShowActionTypes.previous?this.bounceSlideBy:this.bounceSlideBy*-1,0,this.settings.slideSpeed,this.bounceStepOneEventHandler))},onBounceStepOne:function(){var b=this;c.setTimeout(function(){a.Animation.slideBy(b.el,b.lastShowAction===Code.PhotoSwipe.SliderClass.ShowActionTypes.previous?b.bounceSlideBy*-1:b.bounceSlideBy,0,b.settings.slideSpeed,b.bounceStepTwoEventHandler)},25)},onBounceStepTwo:function(){this.dispatchDisplayCurrentFullSizeImage()},onShowNextEnd:function(){a.DOM.show(this.currentItem.imageContainerEl);a.swapArrayElements(this.items,1,2);this.currentItem=this.items[1];this.nextItem=this.items[2];var b=this.parentElWidth;a.DOM.setStyle(this.currentItem.el,"left",b+"px");a.DOM.setStyle(this.nextItem.el,"left",b*2+"px");this.center();this.dispatchDisplayCurrentFullSizeImage()},onShowPreviousEnd:function(){a.DOM.show(this.currentItem.imageContainerEl);a.swapArrayElements(this.items,1,0);this.currentItem=this.items[1];this.previousItem=this.items[0];a.DOM.setStyle(this.currentItem.el,"left",this.parentElWidth+"px");a.DOM.setStyle(this.previousItem.el,"left","0px");this.center();this.dispatchDisplayCurrentFullSizeImage()},onSliderFullSizeImageLoadAnomaly:function(b){b=b.fullSizeImage;!a.isNothing(this.currentItem.fullSizeImage)&&this.currentItem.fullSizeImage.index===b.index?(this.currentItem.setFullSizeImage(b),this.dispatchDisplayCurrentFullSizeImage()):!a.isNothing(this.nextItem.fullSizeImage)&&this.nextItem.fullSizeImage.index===b.index?this.nextItem.setFullSizeImage(b):a.isNothing(this.previousItem.fullSizeImage)||this.previousItem.fullSizeImage.index===b.index&&this.previousItem.setFullSizeImage(b)},dispatchDisplayCurrentFullSizeImage:function(){this.dispatchEvent({type:Code.PhotoSwipe.SliderClass.EventTypes.onDisplayCurrentFullSizeImage,target:this,fullSizeImage:this.currentItem.fullSizeImage})}});Code.PhotoSwipe.SliderClass.CssClasses={slider:"ps-slider"};Code.PhotoSwipe.SliderClass.ShowActionTypes={next:"next",previous:"previous"};Code.PhotoSwipe.SliderClass.EventTypes={onDisplayCurrentFullSizeImage:"onDisplayCurrentFullSizeImage"}})(window,Code.PhotoSwipe.Util,Code.PhotoSwipe.SliderItemClass);(function(c,a){Code.PhotoSwipe.CaptionClass=Code.PhotoSwipe.ElementClass.extend({contentEl:null,touchMoveHandler:null,captionValue:null,init:function(b){this.settings={position:"top",zIndex:1000};a.extend(this.settings,b);this._super(this.settings);this.captionValue="";this.touchMoveHandler=this.onTouchMove.bind(this);b=Code.PhotoSwipe.CaptionClass.CssClasses.caption;this.settings.position==="bottom"&&(b=b+" "+Code.PhotoSwipe.CaptionClass.CssClasses.bottom);this.el=a.DOM.createElement("div",{"class":b},"");a.DOM.setStyle(this.el,{left:0,position:"absolute",overflow:"hidden",zIndex:this.settings.zIndex,opacity:0});a.DOM.hide(this.el);a.DOM.appendToBody(this.el);this.contentEl=a.DOM.createElement("div",{"class":Code.PhotoSwipe.CaptionClass.CssClasses.content},"");a.DOM.appendChild(this.contentEl,this.el)},addEventListeners:function(){a.browser.touchSupported&&a.DOM.addEventListener(this.el,"touchmove",this.touchMoveHandler)},removeEventListeners:function(){a.browser.touchSupported&&a.DOM.removeEventListener(this.el,"touchmove",this.touchMoveHandler)},onTouchMove:function(a){a.preventDefault()},resetPosition:function(){var b;b=this.settings.position==="bottom"?a.DOM.windowHeight()-a.DOM.outerHeight(this.el)+a.DOM.windowScrollTop():a.DOM.windowScrollTop();a.DOM.setStyle(this.el,"top",b+"px");a.DOM.width(this.el,a.DOM.bodyWidth())},setCaptionValue:function(b){a.DOM.removeChildren(this.contentEl);b=a.coalesce(b,"\u00a0");a.isObject(b)?a.DOM.appendChild(b,this.contentEl):(b===""&&(b="\u00a0"),a.DOM.appendText(b,this.contentEl));this.captionValue=b==="\u00a0"?"":b}});Code.PhotoSwipe.CaptionClass.CssClasses={caption:"ps-caption",bottom:"ps-caption-bottom",content:"ps-caption-content"}})(window,Code.PhotoSwipe.Util);(function(c,a){Code.PhotoSwipe.ToolbarClass=Code.PhotoSwipe.ElementClass.extend({closeEl:null,previousEl:null,nextEl:null,playEl:null,clickHandler:null,touchStartHandler:null,touchMoveHandler:null,touched:null,isNextActive:null,isPreviousActive:null,init:function(b){this.settings={position:"bottom",hideClose:!1,zIndex:1000};a.extend(this.settings,b);this._super(this.settings);this.isPreviousActive=this.isNextActive=!0;this.touched=!1;this.clickHandler=this.onClick.bind(this);if(a.browser.touchSupported){this.touchMoveHandler=this.onTouchMove.bind(this),this.touchStartHandler=this.onTouchStart.bind(this)}b=Code.PhotoSwipe.ToolbarClass.CssClasses.caption;this.settings.position==="top"&&(b=b+" "+Code.PhotoSwipe.ToolbarClass.CssClasses.top);this.el=a.DOM.createElement("div",{"class":b},"");a.DOM.setStyle(this.el,{left:0,position:"absolute",overflow:"hidden",zIndex:this.settings.zIndex,display:"table",opacity:0});a.DOM.hide(this.el);a.DOM.appendToBody(this.el);this.closeEl=a.DOM.createElement("div",{"class":Code.PhotoSwipe.ToolbarClass.CssClasses.close},'<div class="'+Code.PhotoSwipe.ToolbarClass.CssClasses.content+'"></div>');this.settings.hideClose&&a.DOM.hide(this.closeEl);a.DOM.appendChild(this.closeEl,this.el);this.playEl=a.DOM.createElement("div",{"class":Code.PhotoSwipe.ToolbarClass.CssClasses.play},'<div class="'+Code.PhotoSwipe.ToolbarClass.CssClasses.content+'"></div>');a.DOM.appendChild(this.playEl,this.el);this.previousEl=a.DOM.createElement("div",{"class":Code.PhotoSwipe.ToolbarClass.CssClasses.previous},'<div class="'+Code.PhotoSwipe.ToolbarClass.CssClasses.content+'"></div>');a.DOM.appendChild(this.previousEl,this.el);this.nextEl=a.DOM.createElement("div",{"class":Code.PhotoSwipe.ToolbarClass.CssClasses.next},'<div class="'+Code.PhotoSwipe.ToolbarClass.CssClasses.content+'"></div>');a.DOM.appendChild(this.nextEl,this.el)},postFadeIn:function(){this.isHidden||(a.DOM.setStyle(this.el,{display:"table"}),this._super(this.settings))},addEventListeners:function(){a.browser.touchSupported&&(a.browser.isBlackberry||a.DOM.addEventListener(this.el,"touchstart",this.touchStartHandler),a.DOM.addEventListener(this.el,"touchmove",this.touchMoveHandler));a.DOM.addEventListener(this.el,"click",this.clickHandler)},removeEventListeners:function(){a.browser.touchSupported&&(a.browser.isBlackberry||a.DOM.removeEventListener(this.el,"touchstart",this.touchStartHandler),a.DOM.removeEventListener(this.el,"touchmove",this.touchMoveHandler));a.DOM.removeEventListener(this.el,"click",this.clickHandler)},onTouchStart:function(a){a.preventDefault();this.touched=!0;this.handleClick(a)},onTouchMove:function(a){a.preventDefault()},onClick:function(a){this.touched||this.handleClick(a)},handleClick:function(b){var d;switch(b.target.parentNode){case this.previousEl:if(this.isPreviousActive){d=Code.PhotoSwipe.ToolbarClass.Actions.previous}break;case this.nextEl:if(this.isNextActive){d=Code.PhotoSwipe.ToolbarClass.Actions.next}break;case this.playEl:d=Code.PhotoSwipe.ToolbarClass.Actions.play;break;case this.closeEl:d=Code.PhotoSwipe.ToolbarClass.Actions.close}a.isNothing(d)||this.dispatchEvent({type:Code.PhotoSwipe.ToolbarClass.EventTypes.onClick,target:this,action:d})},resetPosition:function(){var b;b=this.settings.position==="bottom"?a.DOM.windowHeight()-a.DOM.outerHeight(this.el)+a.DOM.windowScrollTop():a.DOM.windowScrollTop();a.DOM.setStyle(this.el,"top",b+"px");a.DOM.width(this.el,a.DOM.bodyWidth())},setNextState:function(b){b?(a.DOM.addClass(this.nextEl,Code.PhotoSwipe.ToolbarClass.CssClasses.nextDisabled),this.isNextActive=!1):(a.DOM.removeClass(this.nextEl,Code.PhotoSwipe.ToolbarClass.CssClasses.nextDisabled),this.isNextActive=!0)},setPreviousState:function(b){b?(a.DOM.addClass(this.previousEl,Code.PhotoSwipe.ToolbarClass.CssClasses.previousDisabled),this.isPreviousActive=!1):(a.DOM.removeClass(this.previousEl,Code.PhotoSwipe.ToolbarClass.CssClasses.previousDisabled),this.isPreviousActive=!0)}});Code.PhotoSwipe.ToolbarClass.CssClasses={caption:"ps-toolbar",top:"ps-toolbar-top",close:"ps-toolbar-close",previous:"ps-toolbar-previous",previousDisabled:"ps-toolbar-previous-disabled",next:"ps-toolbar-next",nextDisabled:"ps-toolbar-next-disabled",play:"ps-toolbar-play",content:"ps-toolbar-content"};Code.PhotoSwipe.ToolbarClass.Actions={close:"close",previous:"previous",next:"next",play:"play"};Code.PhotoSwipe.ToolbarClass.EventTypes={onClick:"onClick"}})(window,Code.PhotoSwipe.Util);(function(c,a,b,d){Code.PhotoSwipe.CaptionToolbarClass=Code.PhotoSwipe.EventClass.extend({toolbar:null,caption:null,isHidden:null,hasAddedEventListeners:null,toolbarClickEventHandler:null,init:function(c){this._super();this.settings={opacity:0.8,fadeInSpeed:250,fadeOutSpeed:500,autoHideDelay:5000,flipPosition:!1,showEmptyCaptions:!0,hideClose:!1,zIndex:1000};a.extend(this.settings,c);this.isHidden=!0;this.hasAddedEventListeners=!1;this.toolbarClickEventHandler=this.onToolbarClick.bind(this);this.caption=new b({fadeInSpeed:this.settings.fadeInSpeed,fadeOutSpeed:this.settings.fadeOutSpeed,opacity:this.settings.opacity,position:this.settings.flipPosition?"bottom":"top",zIndex:this.settings.zIndex});this.toolbar=new d({fadeInSpeed:this.settings.fadeInSpeed,fadeOutSpeed:this.settings.fadeOutSpeed,opacity:this.settings.opacity,position:this.settings.flipPosition?"top":"bottom",hideClose:this.settings.hideClose,zIndex:this.settings.zIndex+1})},resetPosition:function(){this.caption.resetPosition();this.toolbar.resetPosition()},addEventListeners:function(){if(!this.hasAddedEventListeners){this.toolbar.addEventListener(d.EventTypes.onClick,this.toolbarClickEventHandler),this.hasAddedEventListeners=!0}},removeEventListeners:function(){this.toolbar.removeEventListener(d.EventTypes.onClick,this.toolbarClickEventHandler);this.hasAddedEventListeners=!1},fadeIn:function(){this.stopAutoHideTimeout();this.stopFade();this.isHidden?(this.isHidden=!1,this.fadeInCaption(),this.toolbar.fadeIn(),c.setTimeout(this.onFadeIn.bind(this),this.settings.fadeInSpeed)):(this.caption.isHidden&&this.fadeInCaption(),this.resetAutoHideTimeout())},showCaption:function(){this.caption.captionValue===""?this.settings.showEmptyCaptions&&this.caption.show():this.caption.show()},fadeInCaption:function(){this.caption.captionValue===""?this.settings.showEmptyCaptions&&this.caption.fadeIn():this.caption.fadeIn()},onFadeIn:function(){this.addEventListeners();this.resetAutoHideTimeout();this.dispatchEvent({type:Code.PhotoSwipe.CaptionToolbarClass.EventTypes.onShow,target:this})},fadeOut:function(){this.stopAutoHideTimeout();this.stopFade();this.isHidden=!0;this.caption.fadeOut();this.toolbar.fadeOut();c.setTimeout(this.onFadeOut.bind(this),this.settings.fadeOutSpeed)},onFadeOut:function(){this.dispatchEvent({type:Code.PhotoSwipe.CaptionToolbarClass.EventTypes.onHide,target:this})},stopFade:function(){this.caption.stopFade();this.toolbar.stopFade()},hide:function(){this.stopAutoHideTimeout();this.stopFade();this.isHidden=!0;this.removeEventListeners();this.caption.hide();this.toolbar.hide();this.dispatchEvent({type:Code.PhotoSwipe.CaptionToolbarClass.EventTypes.onHide,target:this})},setCaptionValue:function(a){this.caption.setCaptionValue(a);this.caption.captionValue===""&&!this.settings.showEmptyCaptions&&this.caption.fadeOut()},resetAutoHideTimeout:function(){if(!this.isHidden&&(this.stopAutoHideTimeout(),this.settings.autoHideDelay>0)){this.autoHideTimeout=c.setTimeout(this.fadeOut.bind(this),this.settings.autoHideDelay)}},stopAutoHideTimeout:function(){a.isNothing(this.autoHideTimeout)||c.clearTimeout(this.autoHideTimeout)},onToolbarClick:function(a){this.dispatchEvent({type:Code.PhotoSwipe.ToolbarClass.EventTypes.onClick,target:this,action:a.action})},setNextState:function(a){this.toolbar.setNextState(a)},setPreviousState:function(a){this.toolbar.setPreviousState(a)}});Code.PhotoSwipe.CaptionToolbarClass.EventTypes={onShow:"onShow",onHide:"onHide"}})(window,Code.PhotoSwipe.Util,Code.PhotoSwipe.CaptionClass,Code.PhotoSwipe.ToolbarClass);(function(c,a){Code.PhotoSwipe.ZoomPanRotateClass=Code.PhotoSwipe.ElementClass.extend({containerEl:null,imageEl:null,parentEl:null,transformSettings:null,panStartingPoint:null,init:function(b,d,c){this.settings={maxZoom:5,minZoom:0.5,adjustPanToZoom:!0};a.extend(this.settings,b);this._super(b);this.parentEl=d;this.imageEl=c.cloneNode(!1);this.transformSettings={startingScale:1,scale:1,startingRotation:0,rotation:0,startingTranslateX:0,startingTranslateY:0,translateX:0,translateY:0};this.el=a.DOM.createElement("div",{"class":Code.PhotoSwipe.ZoomPanRotateClass.CssClasses.documentOverlay},"");a.DOM.setStyle(this.el,{left:0,top:0,position:"absolute"});a.DOM.width(this.el,a.DOM.bodyWidth());a.DOM.height(this.el,a.DOM.windowHeight());this.containerEl=a.DOM.createElement("div");a.DOM.setStyle(this.containerEl,{left:0,top:0,position:"absolute"});a.DOM.width(this.containerEl,a.DOM.bodyWidth());a.DOM.height(this.containerEl,a.DOM.windowHeight());a.DOM.appendChild(this.imageEl,this.containerEl);a.DOM.appendChild(this.containerEl,this.el);a.DOM.appendChild(this.el,this.parentEl)},setStartingTranslateFromCurrentTranform:function(){var b=this.containerEl.style.webkitTransform.match(/translate\((.*?)\)/);if(!a.isNothing(b)){b=b[1].split(", "),this.transformSettings.startingTranslateX=c.parseInt(b[0]),this.transformSettings.startingTranslateY=c.parseInt(b[1])}},setStartingScaleAndRotation:function(a,d){var c=this.transformSettings.startingScale*a;if(this.settings.minZoom!==0&&c<this.settings.minZoom){c=this.settings.minZoom}else{if(this.settings.maxZoom!==0&&c>this.settings.maxZoom){c=this.settings.maxZoom}}this.transformSettings.startingScale=c;this.transformSettings.startingRotation=(this.transformSettings.startingRotation+d)%360},zoomRotate:function(a,c){var e=this.transformSettings.startingScale*a;if(this.settings.minZoom!==0&&e<this.settings.minZoom){e=this.settings.minZoom}else{if(this.settings.maxZoom!==0&&e>this.settings.maxZoom){e=this.settings.maxZoom}}this.transformSettings.scale=e;this.transformSettings.rotation=this.transformSettings.startingRotation+c;this.applyTransform()},panStart:function(a){this.setStartingTranslateFromCurrentTranform();this.panStartingPoint={x:a.x,y:a.y}},pan:function(a){var c=a.x-this.panStartingPoint.x,a=a.y-this.panStartingPoint.y,a=a/this.transformSettings.scale?a/this.transformSettings.scale:a;this.transformSettings.translateX=this.transformSettings.startingTranslateX+(this.settings.adjustPanToZoom?c/this.transformSettings.scale:c);this.transformSettings.translateY=this.transformSettings.startingTranslateY+a;this.applyTransform()},applyTransform:function(){this.containerEl.style.webkitTransform="scale("+this.transformSettings.scale+") rotate("+this.transformSettings.rotation%360+"deg) translate("+this.transformSettings.translateX+"px, "+this.transformSettings.translateY+"px)"},removeFromDOM:function(){a.DOM.removeChild(this.el,this.parentEl)}});Code.PhotoSwipe.ZoomPanRotateClass.CssClasses={documentOverlay:"ps-zoom-pan-rotate"}})(window,Code.PhotoSwipe.Util);(function(c,a,b,d,e,g,f,h,i,j,k){h=Code.PhotoSwipe.EventClass.extend({fullSizeImages:null,documentOverlay:null,viewport:null,slider:null,captionAndToolbar:null,zoomPanRotate:null,settings:null,currentIndex:null,isBusy:null,isActive:null,currentHistoryHashValue:null,isBackEventSupported:null,slideshowTimeout:null,isSlideshowActive:null,lastShowPrevTrigger:null,backButtonClicked:null,viewportFadeInEventHandler:null,windowOrientationChangeEventHandler:null,windowScrollEventHandler:null,windowHashChangeHandler:null,keyDownEventHandler:null,viewportTouchEventHandler:null,viewportFadeOutEventHandler:null,sliderDisplayCurrentFullSizeImageEventHandler:null,toolbarClickEventHandler:null,captionAndToolbarShowEventHandler:null,captionAndToolbarHideEventHandler:null,orientationEventName:null,init:function(){this._super();this.currentIndex=0;this.backButtonClicked=this.isSlideshowActive=this.isActive=this.isBusy=!1;this.settings={getImageSource:Code.PhotoSwipe.GetImageSource,getImageCaption:Code.PhotoSwipe.GetImageCaption,getImageMetaData:Code.PhotoSwipe.GetImageMetaData,fadeInSpeed:250,fadeOutSpeed:500,slideSpeed:250,swipeThreshold:50,swipeTimeThreshold:250,loop:!0,slideshowDelay:3000,imageScaleMethod:"fit",preventHide:!1,zIndex:1000,backButtonHideEnabled:!0,jQueryMobile:!a.isNothing(c.jQuery)&&!a.isNothing(c.jQuery.mobile),jQueryMobileDialogHash:"&ui-state=dialog",allowUserZoom:!0,allowRotationOnUserZoom:!0,maxUserZoom:5,minUserZoom:0.5,adjustUserPanToZoom:!0,captionAndToolbarHide:!1,captionAndToolbarHideOnSwipe:!0,captionAndToolbarFlipPosition:!1,captionAndToolbarAutoHideDelay:5000,captionAndToolbarOpacity:0.8,captionAndToolbarShowEmptyCaptions:!0};if(a.browser.isAndroid&&navigator.userAgent.indexOf("2.1")){this.isBackEventSupported=!0}if(!this.isBackEventSupported){this.isBackEventSupported="onhashchange" in c}if(this.settings.preventHide){this.settings.backButtonHideEnabled=!1}this.viewportFadeInEventHandler=this.onViewportFadeIn.bind(this);this.windowOrientationChangeEventHandler=this.onWindowOrientationChange.bind(this);this.windowScrollEventHandler=this.onWindowScroll.bind(this);this.windowHashChangeHandler=this.onWindowHashChange.bind(this);this.keyDownEventHandler=this.onKeyDown.bind(this);this.viewportTouchEventHandler=this.onViewportTouch.bind(this);this.viewportFadeOutEventHandler=this.onViewportFadeOut.bind(this);this.sliderDisplayCurrentFullSizeImageEventHandler=this.onSliderDisplayCurrentFullSizeImage.bind(this);this.toolbarClickEventHandler=this.onToolbarClick.bind(this);this.captionAndToolbarShowEventHandler=this.onCaptionAndToolbarShow.bind(this);this.captionAndToolbarHideEventHandler=this.onCaptionAndToolbarHide.bind(this)},setOptions:function(b){a.extend(this.settings,b);if(this.settings.preventHide){this.settings.backButtonHideEnabled=!1}},setImages:function(b){if(!a.isArray){throw"thumbEls is not an array"}this.currentIndex=0;this.fullSizeImages=[];for(var c=0;c<b.length;c++){var d=b[c];this.fullSizeImages.push(new e(c,this.settings.imageScaleMethod,this.settings.getImageSource(d),this.settings.getImageCaption(d),this.settings.getImageMetaData(d)))}},show:function(d){if(!this.isBusy&&!this.isActive){if(!a.isNumber(d)){throw"startingIndex must be a number"}if(a.isNothing(this.fullSizeImages)){throw"need to set images before showing the gallery"}this.backButtonClicked=!1;this.isBusy=this.isActive=!0;this.lastShowPrevTrigger=Code.PhotoSwipe.ShowPrevTriggers.show;a.DOM.addClass(document.body,Code.PhotoSwipe.CssClasses.activeBody);d=c.parseInt(d);if(d<0||d>=this.fullSizeImages.length){d=0}this.currentIndex=d;a.isNothing(this.documentOverlay)?this.build():this.resetPosition();this.viewport.addEventListener(b.EventTypes.onFadeIn,this.viewportFadeInEventHandler);this.dispatchEvent({type:Code.PhotoSwipe.EventTypes.onBeforeShow,target:this});this.viewport.fadeIn()}},build:function(){this.documentOverlay=new d({fadeInSpeed:this.settings.fadeInSpeed,fadeOutSpeed:this.settings.fadeOutSpeed,zIndex:this.settings.zIndex});this.viewport=new g({fadeInSpeed:this.settings.fadeInSpeed,fadeOutSpeed:this.settings.fadeOutSpeed,swipeThreshold:this.settings.swipeThreshold,swipeTimeThreshold:this.settings.swipeTimeThreshold,zIndex:this.settings.zIndex+1});this.slider=new f({fadeInSpeed:this.settings.fadeInSpeed,fadeOutSpeed:this.settings.fadeOutSpeed,slideSpeed:this.settings.slideSpeed},this.viewport.el);this.captionAndToolbar=new j({opacity:this.settings.captionAndToolbarOpacity,fadeInSpeed:this.settings.fadeInSpeed,fadeOutSpeed:this.settings.fadeOutSpeed,autoHideDelay:this.settings.captionAndToolbarAutoHideDelay,flipPosition:this.settings.captionAndToolbarFlipPosition,showEmptyCaptions:this.settings.captionAndToolbarShowEmptyCaptions,hideClose:this.settings.preventHide,zIndex:this.settings.zIndex+3});this.resetPosition()},addEventListeners:function(){this.orientationEventName=a.browser.isAndroid?"resize":"onorientationchange" in c?"orientationchange":"resize";a.DOM.addEventListener(c,this.orientationEventName,this.windowOrientationChangeEventHandler);a.DOM.addEventListener(c,"scroll",this.windowScrollEventHandler);if(this.isBackEventSupported&&this.settings.backButtonHideEnabled){this.settings.jQueryMobile?c.location.hash=this.settings.jQueryMobileDialogHash:(this.currentHistoryHashValue="PhotoSwipe"+(new Date).getTime().toString(),c.location.hash=this.currentHistoryHashValue),a.DOM.addEventListener(c,"hashchange",this.windowHashChangeHandler)}a.DOM.addEventListener(document,"keydown",this.keyDownEventHandler);this.viewport.addEventListener(g.EventTypes.onTouch,this.viewportTouchEventHandler);this.slider.addEventListener(f.EventTypes.onDisplayCurrentFullSizeImage,this.sliderDisplayCurrentFullSizeImageEventHandler);this.captionAndToolbar.addEventListener(i.EventTypes.onClick,this.toolbarClickEventHandler);this.captionAndToolbar.addEventListener(j.EventTypes.onShow,this.captionAndToolbarShowEventHandler);this.captionAndToolbar.addEventListener(j.EventTypes.onHide,this.captionAndToolbarHideEventHandler)},removeEventListeners:function(){a.DOM.removeEventListener(c,this.orientationEventName,this.windowOrientationChangeEventHandler);a.DOM.removeEventListener(c,"scroll",this.windowScrollEventHandler);this.isBackEventSupported&&this.settings.backButtonHideEnabled&&a.DOM.removeEventListener(c,"hashchange",this.windowHashChangeHandler);a.DOM.removeEventListener(document,"keydown",this.keyDownEventHandler);this.viewport.removeEventListener(g.EventTypes.onTouch,this.viewportTouchEventHandler);this.slider.removeEventListener(f.EventTypes.onDisplayCurrentFullSizeImage,this.sliderDisplayCurrentFullSizeImageEventHandler);this.captionAndToolbar.removeEventListener(i.EventTypes.onClick,this.toolbarClickEventHandler);this.captionAndToolbar.removeEventListener(j.EventTypes.onShow,this.captionAndToolbarShowEventHandler);this.captionAndToolbar.removeEventListener(j.EventTypes.onHide,this.captionAndToolbarHideEventHandler)},onViewportFadeIn:function(){this.viewport.removeEventListener(b.EventTypes.onFadeIn,this.viewportFadeInEventHandler);this.documentOverlay.show();this.slider.fadeIn();this.addEventListeners();this.slider.setCurrentFullSizeImage(this.fullSizeImages[this.currentIndex]);this.isBusy=!1;this.dispatchEvent({type:Code.PhotoSwipe.EventTypes.onShow,target:this})},setSliderPreviousAndNextFullSizeImages:function(){var a,b=null,c=null;this.fullSizeImages.length>1&&(a=this.fullSizeImages.length-1,this.currentIndex===a?(this.settings.loop&&(c=this.fullSizeImages[0]),b=this.fullSizeImages[this.currentIndex-1]):this.currentIndex===0?(c=this.fullSizeImages[this.currentIndex+1],this.settings.loop&&(b=this.fullSizeImages[a])):(c=this.fullSizeImages[this.currentIndex+1],b=this.fullSizeImages[this.currentIndex-1]));this.slider.setPreviousAndNextFullSizeImages(b,c)},onKeyDown:function(a){this.stopSlideshow();a.keyCode===37?(a.preventDefault(),this.lastShowPrevTrigger=Code.PhotoSwipe.ShowPrevTriggers.keyboard,this.showPrevious()):a.keyCode===39?(a.preventDefault(),this.lastShowPrevTrigger=Code.PhotoSwipe.ShowPrevTriggers.keyboard,this.showNext()):a.keyCode===38||a.keyCode===40?a.preventDefault():a.keyCode===27?(a.preventDefault(),this.hide()):a.keyCode===32&&(this.settings.hideToolbar?this.hide():this.toggleCaptionAndToolbar(),a.preventDefault())},onWindowOrientationChange:function(){this.resetPosition()},onWindowScroll:function(){this.resetPosition()},onWindowHashChange:function(){if(c.location.hash!=="#"+(this.settings.jQueryMobile?this.settings.jQueryMobileDialogHash:this.currentHistoryHashValue)){this.backButtonClicked=!0,this.hide()}},resetPosition:function(){this.removeZoomPanRotate();this.viewport.resetPosition();this.slider.resetPosition();this.documentOverlay.resetPosition();this.captionAndToolbar.resetPosition();this.dispatchEvent({type:Code.PhotoSwipe.EventTypes.onResetPosition,target:this})},canUserZoom:function(){if(!this.settings.allowUserZoom){return !1}if(this.isBusy){return !1}if(a.isNothing(this.slider.currentItem.fullSizeImage)){return !1}if(!this.slider.currentItem.fullSizeImage.hasLoaded){return !1}return !0},isZoomActive:function(){return !a.isNothing(this.zoomPanRotate)},onViewportTouch:function(b){switch(b.action){case g.Actions.gestureStart:if(this.canUserZoom()){this.stopSlideshow();if(!this.isZoomActive()){this.zoomPanRotate=new k({maxZoom:this.settings.maxUserZoom,minZoom:this.settings.minUserZoom,adjustPanToZoom:this.settings.adjustUserPanToZoom},this.viewport.el,this.slider.currentItem.imageEl),a.DOM.resetTranslate(this.zoomPanRotate.containerEl),a.DOM.resetTranslate(this.zoomPanRotate.imageEl)}this.fadeOutCaptionAndToolbar()}break;case g.Actions.gestureChange:this.isZoomActive()&&this.zoomPanRotate.zoomRotate(b.scale,this.settings.allowRotationOnUserZoom?b.rotation:0);break;case g.Actions.gestureEnd:this.isZoomActive()&&this.zoomPanRotate.setStartingScaleAndRotation(b.scale,this.settings.allowRotationOnUserZoom?b.rotation:0);break;case g.Actions.touchStart:this.stopSlideshow();this.isZoomActive()&&this.zoomPanRotate.panStart(b.point);break;case g.Actions.touchMove:this.isZoomActive()&&this.zoomPanRotate.pan(b.point);break;case g.Actions.click:this.stopSlideshow();this.settings.hideToolbar?this.hide():this.toggleCaptionAndToolbar();this.dispatchEvent({type:Code.PhotoSwipe.EventTypes.onViewportClick,target:this});break;case g.Actions.swipeLeft:this.stopSlideshow();this.lastShowPrevTrigger=Code.PhotoSwipe.ShowPrevTriggers.swipe;this.showNext();break;case g.Actions.swipeRight:this.stopSlideshow(),this.lastShowPrevTrigger=Code.PhotoSwipe.ShowPrevTriggers.swipe,this.showPrevious()}},onViewportFadeOut:function(){this.viewport.removeEventListener(b.EventTypes.onFadeOut,this.viewportFadeOutEventHandler);this.isActive=this.isBusy=!1;this.dispatchEvent({type:Code.PhotoSwipe.EventTypes.onHide,target:this});this.goBackInHistory()},hide:function(){if(!this.isBusy&&!this.settings.preventHide&&this.isActive){this.isBusy=!0,this.removeZoomPanRotate(),this.removeEventListeners(),this.documentOverlay.hide(),this.captionAndToolbar.hide(),this.slider.hide(),a.DOM.removeClass(document.body,Code.PhotoSwipe.CssClasses.activeBody),this.viewport.addEventListener(b.EventTypes.onFadeOut,this.viewportFadeOutEventHandler),this.dispatchEvent({type:Code.PhotoSwipe.EventTypes.onBeforeHide,target:this}),this.viewport.fadeOut()}},hideImmediately:function(){if(this.isActive){this.dispatchEvent({type:Code.PhotoSwipe.EventTypes.onBeforeHide,target:this}),this.removeZoomPanRotate(),this.removeEventListeners(),this.documentOverlay.hide(),this.captionAndToolbar.hide(),this.slider.hide(),this.viewport.hide(),a.DOM.removeClass(document.body,Code.PhotoSwipe.CssClasses.activeBody),this.isActive=this.isBusy=!1,this.dispatchEvent({type:Code.PhotoSwipe.EventTypes.onHide,target:this}),this.goBackInHistory()}},goBackInHistory:function(){this.isBackEventSupported&&this.settings.backButtonHideEnabled&&(this.backButtonClicked||c.history.back())},showNext:function(){if(!this.isBusy){this.isBusy=!0,this.cleanUpZoomPanRotateForNextPrevious(),this.setCaptionAndToolbarOnShowPreviousNext(),this.slider.showNext(),this.dispatchEvent({type:Code.PhotoSwipe.EventTypes.onShowNext,target:this})}},showPrevious:function(){if(!this.isBusy){this.isBusy=!0,this.cleanUpZoomPanRotateForNextPrevious(),this.setCaptionAndToolbarOnShowPreviousNext(),this.wasUserZoomActive&&a.DOM.hide(this.slider.currentItem.imageEl),this.slider.showPrevious(),this.dispatchEvent({type:Code.PhotoSwipe.EventTypes.onShowPrevious,target:this})}},cleanUpZoomPanRotateForNextPrevious:function(){a.isNothing(this.zoomPanRotate)||(this.settings.loop?a.DOM.hide(this.slider.currentItem.imageEl):this.currentIndex>0&&this.currentIndex<this.fullSizeImages.length-2&&a.DOM.hide(this.slider.currentItem.imageEl));this.removeZoomPanRotate()},setCaptionAndToolbarOnShowPreviousNext:function(){if(!this.settings.captionAndToolbarHide){var a=!1;switch(this.lastShowPrevTrigger){case Code.PhotoSwipe.ShowPrevTriggers.toolbar:a=!0;break;case Code.PhotoSwipe.ShowPrevTriggers.slideshow:a=!1;break;default:a=!this.settings.captionAndToolbarHideOnSwipe}a?this.captionAndToolbar.resetAutoHideTimeout():this.fadeOutCaptionAndToolbar()}},onSliderDisplayCurrentFullSizeImage:function(a){this.currentIndex=a.fullSizeImage.index;if(!this.settings.captionAndToolbarHide){this.settings.loop?(this.captionAndToolbar.setNextState(!1),this.captionAndToolbar.setPreviousState(!1)):(this.currentIndex>=this.fullSizeImages.length-1?this.captionAndToolbar.setNextState(!0):this.captionAndToolbar.setNextState(!1),this.currentIndex<1?this.captionAndToolbar.setPreviousState(!0):this.captionAndToolbar.setPreviousState(!1));this.captionAndToolbar.setCaptionValue(this.fullSizeImages[this.currentIndex].caption);a=!1;switch(this.lastShowPrevTrigger){case Code.PhotoSwipe.ShowPrevTriggers.toolbar:a=!0;break;case Code.PhotoSwipe.ShowPrevTriggers.show:a=!0;break;case Code.PhotoSwipe.ShowPrevTriggers.slideshow:a=!1;break;default:a=!this.settings.captionAndToolbarHideOnSwipe}a&&(this.dispatchEvent({type:Code.PhotoSwipe.EventTypes.onBeforeCaptionAndToolbarShow,target:this}),this.captionAndToolbar.fadeIn());this.dispatchEvent({type:Code.PhotoSwipe.EventTypes.onDisplayImage,target:this,image:this.fullSizeImages[this.currentIndex]})}this.lastShowPrevTrigger="";this.setSliderPreviousAndNextFullSizeImages();this.isSlideshowActive&&this.fireSlideshowTimeout();this.isBusy=!1},toggleCaptionAndToolbar:function(){this.settings.captionAndToolbarHide?this.captionAndToolbar.hide():this.captionAndToolbar.isHidden?(this.dispatchEvent({type:Code.PhotoSwipe.EventTypes.onBeforeCaptionAndToolbarShow,target:this}),this.captionAndToolbar.fadeIn()):(this.dispatchEvent({type:Code.PhotoSwipe.EventTypes.onBeforeCaptionAndToolbarHide,target:this}),this.captionAndToolbar.fadeOut())},fadeOutCaptionAndToolbar:function(){!this.settings.captionAndToolbarHide&&!this.captionAndToolbar.isHidden&&(this.dispatchEvent({type:Code.PhotoSwipe.EventTypes.onBeforeCaptionAndToolbarHide,target:this}),this.captionAndToolbar.fadeOut())},onToolbarClick:function(a){this.stopSlideshow();switch(a.action){case i.Actions.previous:this.lastShowPrevTrigger=Code.PhotoSwipe.ShowPrevTriggers.toolbar;this.showPrevious();break;case i.Actions.next:this.lastShowPrevTrigger=Code.PhotoSwipe.ShowPrevTriggers.toolbar;this.showNext();break;case i.Actions.play:this.startSlideshow();break;default:this.hide()}},startSlideshow:function(){if(!this.isBusy){a.isNothing(this.slideshowTimeout)||c.clearTimeout(this.slideshowTimeout),this.removeZoomPanRotate(),this.isSlideshowActive=!0,this.fadeOutCaptionAndToolbar(),this.fireSlideshowTimeout(),this.dispatchEvent({type:Code.PhotoSwipe.EventTypes.onSlideshowStart,target:this})}},stopSlideshow:function(){a.isNothing(this.slideshowTimeout)||c.clearTimeout(this.slideshowTimeout);this.isSlideshowActive=!1;this.dispatchEvent({type:Code.PhotoSwipe.EventTypes.onSlideshowStop,target:this})},fireSlideshowTimeout:function(){var a=!1;this.settings.loop?this.fullSizeImages.length>1&&(a=!0):this.currentIndex<this.fullSizeImages.length-1&&(a=!0);if(a){this.lastShowPrevTrigger=Code.PhotoSwipe.ShowPrevTriggers.slideshow,this.slideshowTimeout=c.setTimeout(this.showNext.bind(this),this.settings.slideshowDelay)}},removeZoomPanRotate:function(){if(!a.isNothing(this.zoomPanRotate)){this.zoomPanRotate.removeFromDOM(),this.zoomPanRotate=null}},onCaptionAndToolbarShow:function(){this.dispatchEvent({type:Code.PhotoSwipe.EventTypes.onCaptionAndToolbarShow,target:this})},onCaptionAndToolbarHide:function(){this.dispatchEvent({type:Code.PhotoSwipe.EventTypes.onCaptionAndToolbarHide,target:this})}});Code.PhotoSwipe.CssClasses={activeBody:"ps-active"};Code.PhotoSwipe.ShowPrevTriggers={show:"show",toolbar:"toobar",swipe:"swipe",keyboard:"keyboard",slideshow:"slideshow"};Code.PhotoSwipe.EventTypes={onBeforeShow:"onBeforeShow",onShow:"onShow",onBeforeHide:"onBeforeHide",onHide:"onHide",onShowNext:"onShowNext",onShowPrevious:"onShowPrevious",onDisplayImage:"onDisplayImage",onResetPosition:"onResetPosition",onSlideshowStart:"onSlideshowStart",onSlideshowStop:"onSlideshowStop",onBeforeCaptionAndToolbarShow:"onBeforeCaptionAndToolbarShow",onCaptionAndToolbarShow:"onCaptionAndToolbarShow",onBeforeCaptionAndToolbarHide:"onBeforeCaptionAndToolbarHide",onCaptionAndToolbarHide:"onCaptionAndToolbarHide",onViewportClick:"onViewportClick"};Code.PhotoSwipe.GetImageSource=function(a){return a.href};Code.PhotoSwipe.GetImageCaption=function(b){if(b.nodeName==="IMG"){return a.DOM.getAttribute(b,"alt")}var c,d;for(c=0;c<b.childNodes.length;c++){if(d=b.childNodes[c],b.childNodes[c].nodeName==="IMG"){return a.DOM.getAttribute(d,"alt")}}};Code.PhotoSwipe.GetImageMetaData=function(){return{}};Code.PhotoSwipe.Current=new h;Code.photoSwipe=function(b,c,d){var e=!0;if(!a.isNothing(b)){if(a.isNothing(c)){c=document.documentElement,e=!1}a.isString(c)&&(c=document.documentElement.querySelector(c));if(a.isNothing(c)){throw"Unable to find container element"}a.isString(b)&&(b=c.querySelectorAll(b));if(!a.isNothing(b)){var f=function(a){a.preventDefault();g(a.currentTarget)},g=function(a){var c;for(c=0;c<b.length;c++){if(b[c]===a){break}}Code.PhotoSwipe.Current.show(c)};Code.PhotoSwipe.Current.setOptions(d);Code.PhotoSwipe.Current.setImages(b);if(e){c.addEventListener("click",function(c){if(c.target!==c.currentTarget){c.preventDefault();var d=function(b,c,e){if(a.isNothing(b)||a.isNothing(c)||a.isNothing(e)){return null}if(b.nodeName===c){return b}if(b===e){return null}return d(b.parentNode,c,e)},c=d(c.target,b[0].nodeName,c.currentTarget);a.isNothing(c)||g(c)}},!1)}else{for(c=0;c<b.length;c++){b[c].addEventListener("click",f,!1)}}return b}}};if(!a.isNothing(c.jQuery)){c.jQuery.fn.photoSwipe=function(a){var b=this;Code.PhotoSwipe.Current.setOptions(a);Code.PhotoSwipe.Current.setImages(b);$(b).live("click",function(a){a.preventDefault();a=$(b).index($(a.currentTarget));Code.PhotoSwipe.Current.show(a)})}}})(window,Code.PhotoSwipe.Util,Code.PhotoSwipe.ElementClass,Code.PhotoSwipe.DocumentOverlayClass,Code.PhotoSwipe.FullSizeImageClass,Code.PhotoSwipe.ViewportClass,Code.PhotoSwipe.SliderClass,Code.PhotoSwipe.CaptionClass,Code.PhotoSwipe.ToolbarClass,Code.PhotoSwipe.CaptionToolbarClass,Code.PhotoSwipe.ZoomPanRotateClass);(function($){var event=$.event,resizeTimeout;event.special.smartresize={setup:function(){$(this).bind("resize",event.special.smartresize.handler)},teardown:function(){$(this).unbind("resize",event.special.smartresize.handler)},handler:function(event,execAsap){var context=this,args=arguments;event.type="smartresize";if(resizeTimeout){clearTimeout(resizeTimeout)}resizeTimeout=setTimeout(function(){jQuery.event.handle.apply(context,args)},execAsap==="execAsap"?0:100)}};$.fn.smartresize=function(fn){return fn?this.bind("smartresize",fn):this.trigger("smartresize",["execAsap"])}})(jQuery);geofill=function(){var fieldstofill=null;var postcode=null;var ipdata=null;function find(o){fieldstofill=o;get("http://geoip.pidgets.com/?format=json&callback=geofill.getpc")}function lookup(pc){postcode=pc;var getcode=null;if(typeof arguments[1]==="string"){getcode=arguments[1]}else{var code=document.getElementById(pc.postcode);if(code){getcode=code.value}}if(getcode){var url="http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20geo.places%20where%20text%3D%22"+getcode+"%22&format=json&callback=geofill.pc";get(url)}}function setPostcode(o){if(o.query.results){var place=o.query.results.place;if(place[1]){place=place[0]}if(place.postal){var filtered={postcode:place.postal.content,city:place.locality1.content,country:place.country.content,latitude:place.centroid.latitude,longitude:place.centroid.longitude};for(var i in postcode){var x=document.getElementById(postcode[i]);if(x){x.value=filtered[i]}}}else{var filtered={error:"postcode"}}}else{var filtered={error:404}}if(typeof postcode.callback==="function"){postcode.callback(filtered)}}function get(url){var s=document.createElement("script");s.setAttribute("src",url);document.getElementsByTagName("head")[0].appendChild(s)}function getPostalfromIP(o){ipdata=o;var url="http://query.yahooapis.com/v1/public/yql?q=select%20postal%20from%20geo.places%20where%20woeid%20in%20(select%20place.woeid%20from%20flickr.places%20where%20lat%3D%22"+o.latitude+"%22%20and%20lon%3D%22"+o.longitude+"%22)&format=json&callback=geofill.set";get(url)}function set(o){var p=(o.query.results.place.postal===null)?"":o.query.results.place.postal.content;var filtered={city:ipdata.city,country:ipdata.country_name,postcode:p,latitude:ipdata.latitude,longitude:ipdata.longitude};for(var i in fieldstofill){var x=document.getElementById(fieldstofill[i]);if(x){x.value=filtered[i]}}if(typeof fieldstofill.callback==="function"){fieldstofill.callback(filtered)}}return{set:set,find:find,pc:setPostcode,lookup:lookup,getpc:getPostalfromIP}}();var SAF=(function(saf){var _pages={};var _scripts={richmarker:"/scripts/richmarker.js",isotope:"/scripts/jquery.isotope.js"};var _googleMapsLoaded=false;var _ga="UA-23482965-1";var _isotopeLoaded=false;var _isDebug=false;saf.init=function(isDebug){_isDebug=isDebug;$("#overlay").hide();_gaq=[["_setAccount",_ga],["_trackPageview"]];(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=g.src="//www.google-analytics.com/ga.js";s.parentNode.insertBefore(g,s)}(document,"script"));$.mobile.defaultPageTransition="none";var webappCache=window.applicationCache;if(webappCache){webappCache.addEventListener("downloading",_downloadingCache,false);webappCache.addEventListener("updateready",_updateCache,false)}var hash=$.trim(location.href.replace(/^[^#]*#?(.*)$/,"$1"));if(hash.length>0){SAF.callPageFunction(hash,["open"])}else{$("#home").live("pagecreate",function(){if(!_parseQuerystring()){_restoreState()}})}window.onerror=function(message,url,ln){if(message){var msg=message;if(message.message){msg=message.message}SAF.debug(msg+" - ln: "+ln);return true}};if($(window).width()>540){$(window).bind("orientationchange smartresize",function(event){_resize()})}$("body").delegate("div[data-role=page]","pageshow",function(event,ui){var pageId=$(this).attr("id");SAF.callPageFunction(pageId,["open"]);_trackImpression(pageId)});$("body").delegate("[data-action]","click",function(){var $this=$(this);var pageId=$this.parents("div[data-role=page]").first().attr("id");var action=$this.attr("data-action");SAF.callPageFunction(pageId,[action])});$("body").delegate(".tabs li","click",function(){var $this=$(this);if($this.hasClass("select")){return}var pageId=$this.parents("div[data-role=page]").first().attr("id");$(".tabs li","#"+pageId).removeClass("current");$this.addClass("current")});$("body").delegate("a[data-icon=saf_search]","click",function(){var $this=$(this);var selected=$this.toggleClass("selected").hasClass("selected");var pageId=$this.parents("div[data-role=page]").first().attr("id");$("form[role=search] input","#"+pageId).val("");$("form[role=search]","#"+pageId).toggle(0,function(){$(window).focus();navigator.userAgent.match(/iPhone|iPod/)||$("input:visible",this).first().focus()});if(!selected){SAF.callPageFunction(pageId,["clearSearch"])}});$("body").delegate("a.ui-input-clear","click",function(){var pageId=$(this).parents("div[data-role=page]").first().attr("id");SAF.callPageFunction(pageId,["clearSearch"])});$("body").delegate("form[role=search]","submit",function(){var pageId=$(this).parents("div[data-role=page]").first().attr("id");var q=$("form[role=search] input","#"+pageId).val();SAF.DB.saveState(pageId,"search",q);SAF.callPageFunction(pageId,["doSearch"],q);return false});$("body").delegate("a[data-icon=favorite]","click",function(){var $this=$(this);var selected=$this.toggleClass("selected").hasClass("selected");var pageId=$this.parents("div[data-role=page]").first().attr("id");var action="favorite";if(!selected){action="unFavorite"}SAF.callPageFunction(pageId,[action])});$("body").delegate("a[data-icon=saf_refresh]","click",function(){var pageId=$(this).parents("div[data-role=page]").first().attr("id");SAF.callPageFunction(pageId,["refresh"])})};saf.registerPage=function(name,obj){_pages[name]=obj};saf.getPage=function(name){return _pages[name]};saf.callPageFunction=function(name,functionNameArray,value){var page=SAF.getPage(name);if(page){if($.isArray(functionNameArray)){for(var i=0;i<functionNameArray.length;i++){var functionName=functionNameArray[i];page[functionName]&&page[functionName].call(this,value)}}}};saf.alertError=function(errorMessage){$("<div class='ui-loader ui-overlay-shadow ui-body-e ui-corner-all'><h1>"+errorMessage+"</h1></div>").css({display:"block",opacity:0.96,top:$(window).scrollTop()+100}).appendTo($.mobile.pageContainer).delay(800).fadeOut(600,function(){$(this).remove()})};saf.alertMessage=function(message){$("<div class='saf-msg ui-loader ui-overlay-shadow ui-body-a ui-corner-all'><h1>"+message+"</h1></div>").css({display:"block",opacity:0.96,top:$(window).scrollTop()+100}).appendTo($.mobile.pageContainer).delay(1500).fadeOut(600,function(){$(this).remove()}).click(function(){$(this).remove()})};saf.hideMessage=function(){$("div.saf-msg").delay(1500).fadeOut(600,function(){$(this).remove()}).click(function(){$(this).remove()})};saf.script=function(name,test,success){if(!_scripts||!(name in _scripts)){console.error("Unknown script: "+name)}else{test()&&success();var d=document.createElement("script");d.type="text/javascript";d.async=!0;d.src=_scripts[name];name=document.getElementsByTagName("script")[0];name.parentNode.insertBefore(d,name);var e=setInterval(function(){test()&&(clearInterval(e),success())},10)}};var _mapsCallback;saf.loadGoogleMaps=function(callback){if(!_googleMapsLoaded){SAF.debug("adding maps script");_mapsCallback=callback;var script=document.createElement("script");script.type="text/javascript";script.src="http://maps.google.com/maps/api/js?sensor=false&callback=SAF.googleMapsCallback";document.body.appendChild(script)}else{callback()}};saf.googleMapsCallback=function(){SAF.debug("loaded maps script, calling cb");_mapsCallback();_googleMapsLoaded=true};saf.scroll=function(scrollTop){scrollTop=parseInt(scrollTop,10);if(SAF.isNumber(scrollTop)){if(scrollTop>150){$.mobile.silentScroll(scrollTop)}}};saf.isotopeIt=function(el,itemSelector,append,html,resize){var w=$(window).width();if(w<540){if(append){$(el).append(html);SAF.highlightNew($(".new",el))}return}if(!_isotopeLoaded){SAF.script("isotope",function(){return jQuery().isotope},function(){_isotopeIt(el,itemSelector);_isotopeLoaded=true})}else{if(!append){if(resize&&$(el).hasClass("isotope")){var elms=$(el).isotope("reLayout").find(itemSelector);__isotopeIt(el,elms)}else{if($(el).hasClass("isotope")){$(el).isotope("destroy")}_isotopeIt(el,itemSelector)}}else{var $new=$(html);$(el).append($new).isotope("insert",$new);SAF.highlightNew($(".new",el));$(el).imagesLoaded(function(){$(el).isotope("reLayout")})}}};function _isotopeIt(el,itemSelector){var elms=$(el).isotope({layoutMode:"masonry",itemSelector:itemSelector,resizable:false,itemPositionDataEnabled:true}).find(itemSelector);__isotopeIt(el,elms)}function __isotopeIt(el,elms){var columnCount=0;var rightX=0;elms.each(function(){var position=$(this).data("isotope-item-position");if(position.y==0){rightX=position.x;columnCount++}else{return false}});elms.each(function(){var $this=$(this);var position=$this.data("isotope-item-position");if(position.x==rightX){$this.addClass("right")}});if(el.indexOf("magazine")>-1){$(el).imagesLoaded(function(){$(el).isotope("reLayout")})}$(el).trigger({type:"isotope",columnCount:columnCount})}saf.resizeIsotope=function(el,itemSelector){var w=$(window).width();if(w<540){if(_isotopeLoaded&&$(el).hasClass("isotope")){$(el).isotope("destroy")}}else{SAF.isotopeIt(el,itemSelector,false,null,true)}};saf.highlightNew=function(el){el.css("background-color","#FFF1A8");morpheus(el,{"background-color":"#fff",duration:1500,complete:function(){el.removeClass("new")}})};saf.setGeoSelect=function(page,currentRadius,onChange){var html='<div data-role="fieldcontain"><select class="geo-select" name="'+page+'-geo-select" id="'+page+'-geo-select" data-theme="b" data-iconpos="noicon" data-inline="true" data-native-menu="false"><optgroup label="Distance"><option value="1">Within 1km</option><option value="5">Within 5km</option><option value="10">Within 10km</option><option value="25">Within 25km</option><option value="50">Within 50km</option><option value="100">Within 100km</option><option value="0">All</option></optgroup></select></div>';$("li.geo","#"+page).html(html);$("#"+page+"-geo-select").val(currentRadius).selectmenu();$("#"+page+"-geo-select").selectmenu("refresh");$("#"+page+"-geo-select").change(onChange)};saf.cleanHTML=function(html){return html.replace(/[]+/gi,"").replace("?s","'s")};saf.cleanElement=function(element){var $el=$(element);$el.html(this.cleanHTML($el.text()))};saf.isNumber=function(n){return !isNaN(parseFloat(n))&&isFinite(n)};saf.locateUser=function(cb){geofill.find({callback:function(o){var result={lat:o.latitude,lng:o.longitude};cb(result)}})};saf.isInView=function(elem){var windowBottom=$(window).scrollTop()+$(window).height();var elemTop=$(elem).offset().top;return elemTop<windowBottom};saf.debug=function(msg){if(_isDebug){if(console){console.debug(msg)}}};saf.onActionClick=function(pageId,action){SAF.callPageFunction(pageId,[action]);SAF.DB.saveState(pageId,action)};saf.os=detect(navigator.userAgent);function _resize(){var activePage=$.mobile.activePage;var pageId=$(activePage).attr("id");if(pageId){var page=SAF.getPage(pageId);if(page){page.resize&&page.resize()}}}function _restoreState(){SAF.DB.getState(function(page,view,value){switch(page){case"news":$.mobile.changePage("#news");if(view=="search"){var page=SAF.getPage("news");if(page){value&&page.doSearch&&page.doSearch(value)}}break;case"news-read":SAF.Story.load(value,"news");break;case"magazine-read":SAF.Article.load(value,"magazine");break;case"favorites":$.mobile.changePage("#favorites");break;case"collections":$.mobile.changePage("#collections");break;case"collection":if(SAF.isNumber(value)){SAF.Collection.load(value,"collections")}break;case"places":$.mobile.changePage("#places");break;case"specials":$.mobile.changePage("#specials");break;case"magazine":$.mobile.changePage("#magazine");break;case"place":if(SAF.isNumber(value)){SAF.Place.load(value,"places")}break}})}function _parseQuerystring(){var pageName=_getParameterByName("page");if(pageName){SAF.debug("Parsing querystring: "+pageName);switch(pageName){case"news":$.mobile.changePage("#news");var sourceName=_getParameterByName("source");if(sourceName){SAF.News.filterBySource(sourceName)}else{SAF.callPageFunction("news",["open"])}break;case"read":var id=parseInt(_getParameterByName("id"),10);if(SAF.isNumber(id)){SAF.Story.load(id.toUpperCase(),"news")}break;case"places":$.mobile.changePage("#places");SAF.callPageFunction("places",["open"]);break;case"place":var id=parseInt(_getParameterByName("id"),10);if(SAF.isNumber(id)){SAF.Place.load(id,"places")}break}return true}return false}function _getParameterByName(name){var match=RegExp("[?&]"+name+"=([^&]*)").exec(window.location.search);return match&&decodeURIComponent(match[1].replace(/\+/g," "))}function _downloadingCache(){SAF.alertMessage("Installing latest version...")}function _updateCache(){if(window.applicationCache){window.applicationCache.swapCache();SAF.hideMessage();$("<div class='saf-msg ui-loader ui-overlay-shadow ui-body-a ui-corner-all'><h1>New version ready to install. Tap to install.</h1></div>").css({display:"block",opacity:0.96,top:$(window).scrollTop()+100}).appendTo($.mobile.pageContainer).click(function(){$(this).remove();window.location.reload()})}}function _trackImpression(pageId){setTimeout(function(){try{var pageTracker=_gat._getTracker(_ga);if(pageTracker){pageTracker._trackPageview(pageId)}}catch(err){}},100);setTimeout(function(){try{if(pSUPERFLY){pSUPERFLY.virtualPage("/"+pageId,pageId)}}catch(err){}},100)}return saf})(SAF||{});var _gaq;var addToHomeConfig;SAF.DB=(function(db){var _store;db.enabled=false;db.init=function(){_store=new Lawnchair({name:"safMobile"},function(store){SAF.DB.enabled=true})};db.saveState=function(page,view,value){_store.save({key:"state",page:page,view:view,value:value})};db.getState=function(callback){_store.get("state",function(r){var page=(r&&r.page)?r.page:null;var view=(r&&r.view)?r.view:null;var value=(r&&r.value)?r.value:null;if(page!=null){callback(page,view,value)}})};function _read(type,id,callback){_store.get(type+"Reads",function(r){var reads=(r&&r.collection)?r.collection:[];for(var i=0;i<reads.length;i++){if(reads[i].id==id){return}}reads[reads.length]={id:id};if(reads.length>250){reads.shift()}_store.save({key:type+"Reads",collection:reads},callback)})}db.readStory=function(id,cb){_read("news",id,cb)};db.readMagazineArticle=function(id,cb){_read("magazine",id,cb)};function _getReads(type,callback){_store.get(type+"Reads",function(r){var reads=(r&&r.collection)?r.collection:[];callback(reads)})}db.getReadStories=function(cb){_getReads("news",cb)};db.getReadMagazineArticles=function(cb){_getReads("magazine",cb)};function _getFavorites(type,callback){_store.get(type+"Favorites",function(r){var favorites=(r&&r.collection)?r.collection:[];callback(favorites)})}db.getFavoritePlaces=function(cb){_getFavorites("place",cb)};db.getFavoriteStories=function(cb){_getFavorites("news",cb)};db.getFavoriteMagazineArticles=function(cb){_getFavorites("magazine",cb)};db.getFavoriteCollections=function(cb){_getFavorites("collection",cb)};db.getFavoriteSpecials=function(cb){_getFavorites("special",cb)};db.getSettings=function(callback){_store.get("settings",function(r){var settings=(r&&r.settings)?r.settings:null;callback(settings)})};db.saveSettings=function(settings,callback){_store.save({key:"settings",settings:settings},callback)};function _isFav(type,id,callback){_store.get(type+"Favorites",function(r){var favorites=(r&&r.collection)?r.collection:[];for(var i=0;i<favorites.length;i++){if(favorites[i].id==id){callback(true);return}}callback(false)})}db.isFavoriteStory=function(id,cb){_isFav("news",id,cb)};db.isFavoritePlace=function(id,cb){_isFav("place",id,cb)};db.isFavoriteMagazineArticle=function(id,cb){_isFav("magazine",id,cb)};db.isFavoriteCollection=function(id,cb){_isFav("collection",id,cb)};db.isFavoriteSpecial=function(id,cb){_isFav("special",id,cb)};db.favoritePlace=function(id,name,excerpt,email,tel,addr,image,callback){_store.get("placeFavorites",function(r){var favorites=(r&&r.collection)?r.collection:[];favorites[favorites.length]={id:id,name:name,excerpt:excerpt,email:email,tel:tel,address:addr,image:image};if(favorites.length>100){favorites.shift()}_store.save({key:"placeFavorites",collection:favorites},callback)})};db.favoriteMagazineArticle=function(id,title,excerpt,img,timestamp,callback){_store.get("magazineFavorites",function(r){var favorites=(r&&r.collection)?r.collection:[];favorites[favorites.length]={id:id,title:title,excerpt:excerpt,image:img,datetime:timestamp};if(favorites.length>100){favorites.shift()}_store.save({key:"magazineFavorites",collection:favorites},callback)})};db.favoriteCollection=function(id,title,excerpt,img,count,timestamp,callback){_store.get("collectionFavorites",function(r){var favorites=(r&&r.collection)?r.collection:[];favorites[favorites.length]={id:id,title:title,excerpt:excerpt,image:img,datetime:timestamp,count:count};if(favorites.length>100){favorites.shift()}_store.save({key:"collectionFavorites",collection:favorites},callback)})};db.favoriteSpecial=function(id,title,excerpt,img,dates,location,timestamp,callback){_store.get("specialFavorites",function(r){var favorites=(r&&r.collection)?r.collection:[];favorites[favorites.length]={id:id,title:title,excerpt:excerpt,image:img,datetime:timestamp,dates:dates,location:location};if(favorites.length>100){favorites.shift()}_store.save({key:"specialFavorites",collection:favorites},callback)})};db.favoriteStory=function(storyId,title,excerpt,source,domain,timestamp,callback){_store.get("newsFavorites",function(r){var favorites=(r&&r.collection)?r.collection:[];favorites[favorites.length]={id:storyId,title:title,excerpt:excerpt,source:source,domain:domain,datetime:timestamp};if(favorites.length>100){favorites.shift()}_store.save({key:"newsFavorites",collection:favorites},callback)})};function _unFav(type,id,callback){_store.get(type+"Favorites",function(r){var favorites=(r&&r.collection)?r.collection:[];var newFavorites=[];for(var i=0;i<favorites.length;i++){if(favorites[i].id!=id){newFavorites[newFavorites.length]=favorites[i]}}_store.save({key:type+"Favorites",collection:newFavorites},callback)})}db.unFavoritePlace=function(id,cb){_unFav("place",id,cb)};db.unFavoriteStory=function(id,cb){_unFav("news",id,cb)};db.unFavoriteMagazineArticle=function(id,cb){_unFav("magazine",id,cb)};db.unFavoriteCollection=function(id,cb){_unFav("collection",id,cb)};db.unFavoriteSpecial=function(id,cb){_unFav("special",id,cb)};db.deleteFavoritePlaces=function(cb){_store.remove("placeFavorites",cb)};db.deleteFavoriteStories=function(cb){_store.remove("newsFavorites",cb)};db.deleteFavoriteMagazineArticles=function(cb){_store.remove("magazineFavorites",cb)};db.deleteFavoriteCollections=function(cb){_store.remove("collectionFavorites",cb)};db.deleteFavoriteSpecials=function(cb){_store.remove("specialFavorites",cb)};return db})(SAF.DB||{});SAF.DB.init();SAF.Settings=(function(settings){settings.loaded=false;settings.placesRadius=1;settings.specialsRadius=5;settings.newsRadius=0;settings.newsSection=" ";settings.newsSectionType=" ";settings.specialsCategory=" ";settings.init=function(callback){SAF.DB.getSettings(function(settings){SAF.Settings.loaded=true;_populate(settings);callback&&callback()})};settings.save=function(){var settings={placesRadius:parseInt(SAF.Settings.placesRadius,10),specialsRadius:parseInt(SAF.Settings.specialsRadius,10),newsRadius:parseInt(SAF.Settings.newsRadius,10),newsSection:SAF.Settings.newsSection,newsSectionType:SAF.Settings.newsSectionType,specialsCategory:SAF.Settings.specialsCategory};SAF.DB.saveSettings(settings)};function _populate(settings){if(!settings){return}if(SAF.isNumber(settings.placesRadius)){SAF.Settings.placesRadius=settings.placesRadius}if(SAF.isNumber(settings.specialsRadius)){SAF.Settings.specialsRadius=settings.specialsRadius}if(SAF.isNumber(settings.newsRadius)){SAF.Settings.newsRadius=settings.newsRadius}if(settings.newsSection){SAF.Settings.newsSection=settings.newsSection}if(settings.newsSectionType){SAF.Settings.newsSectionType=settings.newsSectionType}if(settings.specialsCategory){SAF.Settings.specialsCategory=settings.specialsCategory}}return settings})(SAF.Settings||{});var Query=(function(query){function _buildUrl(url,key,value){var first="?";if(url.indexOf("?")>-1){first="&"}return url+first+key+"="+value}query.mergeParams=function(params,existing){var result=existing;for(var i=0;i<existing.length;i++){for(var j=0;j<params.length;j++){var oldKey=existing[i].key;var newKey=params[j].key;if(oldKey==newKey){result[i].value=params[j].value;params[j].value=null}}}for(var j=0;j<params.length;j++){if(params[j].value!=null){result[result.length]=params[j]}}return result};query.execute=function(url,limit,start,keywords,params,callback,append){url=url+keywords;if(limit){url=_buildUrl(url,"limit",limit)}if(start){url=_buildUrl(url,"start",start)}if(params){for(var i=0;i<params.length;i++){if(params[i].value!=null){url=_buildUrl(url,params[i].key,params[i].value)}}}url=_buildUrl(url,"callback","?");$.getJSON(url,function(data){callback(data,append)})};query.hasKey=function(params,key){if(params){for(var i=0;i<params.length;i++){if(params[i].key==key){if(params[i].value!=null){return true}}}}return false};query.load=function(url,callback){url=_buildUrl(url,"callback","?");$.getJSON(url,callback)};return query})(Query||{});SAF.Home=(function(home){home.init=function(){SAF.registerPage("home",this)};home.open=function(){SAF.DB.saveState("home")};return home})(SAF.Home||{});$(function(){SAF.Home.init()});SAF.News=(function(news){var _baseAPIUrl="http://api.safindit.co.za/v1/news/";var _currentType="latest";var _currentParams=[];var _currentQuery="*";var _itemsPerPage=20;var _currentStart=0;var _currentRadius=0;var _geoRetry=false;var _scrollTop=0;var _loaded=false;var _lastQuery=new Date();news.init=function(){SAF.registerPage("news",this);if($(window).width()>1000){_itemsPerPage=50}};news.open=function(){if(!_loaded){if(!SAF.Settings.loaded){SAF.Settings.init(function(){_open()})}else{_open()}}else{var minsSinceLastQuery=Math.ceil((new Date().getTime()-_lastQuery.getTime())/(1000*60));if(minsSinceLastQuery>3){SAF.News.refresh()}}SAF.DB.saveState("news")};function _open(){var sectionType=SAF.Settings.newsSectionType;var section=SAF.Settings.newsSection;if($.trim(sectionType).length>0){switch(sectionType){case"domain":SAF.News.filterByDomain(section,true);break;case"source":SAF.News.filterBySource(section,true);break;case"blogs":case"mainstream":SAF.News.filterByType(section,true);break}}_currentRadius=SAF.Settings.newsRadius;SAF.setGeoSelect("news",_currentRadius,function(){_currentRadius=parseInt($(this).val(),10);SAF.Settings.newsRadius=_currentRadius;SAF.Settings.save();SAF.News.geo()});if(_currentRadius>0){SAF.News.geo()}else{_load()}_loaded=true}news.latest=function(){_currentStart=0;_currentType="latest";_load()};news.hot=function(){_currentStart=0;_currentType="hot";_load()};news.filterByDomain=function(domain,skipLoad){_currentStart=0;_clearFilterParams();if(domain=="All"){domain=null}_currentParams=Query.mergeParams([{key:"domain",value:domain}],_currentParams);if(!skipLoad){_load()}};news.filterBySource=function(source,skipLoad){_currentStart=0;_clearFilterParams();_currentParams=Query.mergeParams([{key:"source",value:source}],_currentParams);if(!skipLoad){_load()}};news.filterByType=function(type,skipLoad){var typeID=1;if(type.toLowerCase()=="blogs"){typeID=2}_currentStart=0;_clearFilterParams();_currentParams=Query.mergeParams([{key:"sourcetype",value:typeID}],_currentParams);if(!skipLoad){_load()}};news.clearFilters=function(){_currentStart=0;_clearFilterParams();_load()};news.more=function(){_currentStart=_currentStart+_itemsPerPage;_load(true)};news.refresh=function(){_currentStart=0;_load()};news.doSearch=function(keywords){_currentQuery=keywords;_currentStart=0;_load()};news.clearSearch=function(){if(_currentQuery=="*"){return}_currentQuery="*";_currentStart=0;_load()};news.read=function(id){_scrollTop=$(window).scrollTop();$("#"+id).addClass("read");SAF.Story.load(id,"news")};news.geo=function(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(position){var latLng=position.coords.latitude+","+position.coords.longitude;_currentStart=0;_currentParams=Query.mergeParams([{key:"geo",value:_currentRadius==0?null:latLng},{key:"distance",value:_currentRadius==0?null:_currentRadius}],_currentParams);_load();_geoRetry=false},function(error){if(!_geoRetry){_geoRetry=true;SAF.News.geo()}},{enableHighAccuracy:true,maximumAge:300000,timeout:10000})}else{SAF.locateUser(function(position){var latLng=position.lat+","+position.lng;_currentStart=0;_currentParams=Query.mergeParams([{key:"geo",value:_currentRadius==0?null:latLng},{key:"distance",value:_currentRadius==0?null:_currentRadius}],_currentParams);_load()})}};news.loadImage=function(storyId,container){$.getJSON("http://api.safindit.co.za/v1/news/image/"+storyId+"?callback=?",function(data){if(data.response){if(data.response.docs.length==1){var doc=data.response.docs[0];if(doc.images.length==1){var imageData=doc.images[0];$("img.img[data-story-id="+storyId+"]",container).attr("src","data:image/jpg;base64,"+imageData)}}}})};news.scroll=function(){SAF.scroll(_scrollTop)};var _imageState="";news.resize=function(){if($(window).width()<540){if(_imageState!="narrow"){_imageState="narrow";$("img.img","#news-list").removeAttr("height")}}else{if(_imageState!="wide"){_imageState="wide";$("img.img","#news-list").each(function(){$(this).height($(this).height("data-height"))})}}$(".content-primary","#news").width("auto");SAF.resizeIsotope("#news-list","li.article")};function _load(append){$.mobile.showPageLoadingMsg();if(!append){_lastQuery=new Date();$("#news-list").empty();$(".more","#news").hide()}var callback=append===true?function(data){_populate(data,true)}:_populate;Query.execute(_baseAPIUrl+"search/"+_currentType+"/",_itemsPerPage,_currentStart,_currentQuery,_currentParams,callback)}function _populate(data,append){if(data){if(data.response){var count=data.response.numFound;if(count==0){if(!append){var msg="";if(_currentRadius>0){var btnText=_currentRadius>0?_currentRadius+"KM":"Anywhere";msg="<p>News stories are currently confined to a radius of <b><u>"+_currentRadius+"km</u></b> from your <b><u>current location</u></b>. You can either expend the search radius or select to view all news stories by selecting the <b><u>'Within "+btnText+"'</u></b> button above.</p>"}$("#news-list").html("<li class='loading'><h3>No results found.</h3>"+msg+"</li>")}$.mobile.hidePageLoadingMsg();return}if((data.response.docs.length>0)&&(count>data.response.docs.length)){$(".more","#news").show()}else{$(".more","#news").hide()}var html="";for(var i=0;i<data.response.docs.length;i++){var item=data.response.docs[i];var img="";if(item.imageheight_flag=="1"){var imageHeight=" height='"+item.imageheight[0]+"px'";if($(window).width()<540){imageHeight=""}img='<img data-story-id="'+item.id+'" data-height="'+item.imageheight+'" class="img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==" align="right" width="100"'+imageHeight+" />"}var domain="";if(typeof(item.domain)!="undefined"){domain='<div class="tag"><span class="'+item.domain+'">'+item.domain+"</span></div>"}var hdr="<h3>"+domain+'<span class="title">'+item.name+"</span></h3>";if($(window).width()<540){hdr=img+hdr}else{hdr=hdr+img}var excerpt="";if(typeof(item.excerpt)!="undefined"){excerpt=item.excerpt}html+='<li class="article" id="'+item.id+'"><a href="javascript:SAF.News.read(\''+item.id+'\')"><div class="article-inner"><div class="article-container'+(append===true?" new":"")+'">'+hdr+'<div class="prop">'+item.age+' on <span class="source">'+item.source+'</span></div><p class="excerpt">'+excerpt+'</p></div><div class="meta-container"><ol class="stats"><li>Reads<span>:</span><strong>'+item.read+"</strong></li><li>Facebook<span>:</span><strong>"+item.facebook+"</strong></li><li>Twitter<span>:</span><strong>"+item.twitter+'</strong></li></ol><div class="clear"></div></div></div></a></li>';if(item.imageheight_flag=="1"){SAF.News.loadImage(item.id,"#news-list")}}if(append){SAF.isotopeIt("#news-list","li.article",true,html)}else{$("#news-list").html(html);SAF.isotopeIt("#news-list","li.article")}if($(window).width()>540){$("#news-list").bind("isotope",function(event){var width=$("li.article:first","#news-list").width();var columnCount=event.columnCount;var containerWidth=width*columnCount;if($(window).width()-containerWidth<200){$(".content-primary","#news").width(containerWidth+10)}})}_setRead();$(".article","#news-list").each(function(){SAF.cleanElement($("span.title",this));SAF.cleanElement($("p.excerpt",this))})}}else{SAF.alertError("Error. Please try again.")}$.mobile.hidePageLoadingMsg()}function _setRead(){SAF.DB.getReadStories(function(reads){for(var i=0;i<reads.length;i++){$("#"+reads[i].id).addClass("read")}})}function _clearFilterParams(){_currentParams=Query.mergeParams([{key:"domain",value:null},{key:"source",value:null},{key:"sourcetype",value:null}],_currentParams)}return news})(SAF.News||{});$(function(){SAF.News.init()});SAF.News.Filter=(function(filter){filter.init=function(){SAF.registerPage("news-filter",this);$("a[data-filter]","#news-filter").click(function(){var $this=$(this);var filterValue=$this.html();var filterType=$this.attr("data-filter");$.mobile.changePage("#news",{reverse:true});if(filterValue=="All"){$("a[data-icon=saf_filter]","#news").removeClass("selected");$("header h2","#news").html("News")}else{$("a[data-icon=saf_filter]","#news").addClass("selected");$("header h2","#news").html(filterValue)}setTimeout(function(){switch(filterType){case"domain":SAF.News.filterByDomain(filterValue);break;case"type":SAF.News.filterByType(filterValue);break;case"source":SAF.News.filterBySource(filterValue);break}},20)})};filter.back=function(){$.mobile.changePage("#news",{reverse:true});setTimeout(function(){SAF.News.scroll()},20)};return filter})(SAF.News.Filter||{});$(function(){SAF.News.Filter.init()});SAF.Places=(function(places){var _baseAPIUrl="http://api.safindit.co.za/v1/place/";var _currentParams=[];var _currentQuery="*";var _itemsPerPage=20;var _currentStart=0;var _currentRadius=1;var _currentView="list";var _currentData=null;var _currentLat=-30.448674;var _currentLng=24.389648;var _currentSort="hottest";var _locationMarker;var _loaded=false;var _geoRetry=false;var _scrollTop=0;var _map;var _mapMarkers=[];var _markerCluster;places.init=function(){SAF.registerPage("places",this);if($(window).width()>1000){_itemsPerPage=50}};places.open=function(){if(!_loaded){if(!SAF.Settings.loaded){SAF.Settings.init(function(){_open()})}else{_open()}}SAF.DB.saveState("places")};function _open(){_currentRadius=SAF.Settings.placesRadius;SAF.setGeoSelect("places",_currentRadius,function(){_currentRadius=parseInt($(this).val(),10);SAF.Settings.placesRadius=_currentRadius;SAF.Settings.save();SAF.Places.geo()});SAF.Places.geo();_loaded=true}places.geo=function(){if(navigator.geolocation){$.mobile.showPageLoadingMsg();navigator.geolocation.getCurrentPosition(function(position){var latLng=position.coords.latitude+","+position.coords.longitude;_currentLat=position.coords.latitude;_currentLng=position.coords.longitude;_geo(latLng)},function(error){if(!_geoRetry){_geoRetry=true;SAF.Places.geo()}},{enableHighAccuracy:true,maximumAge:300000,timeout:10000})}else{SAF.locateUser(function(position){var latLng=position.lat+","+position.lng;_currentLat=position.coords.latitude;_currentLng=position.coords.longitude;_geo(latLng)})}};function _geo(latLng){_currentStart=0;_currentParams=Query.mergeParams([{key:"geo",value:_currentRadius==0?null:latLng},{key:"distance",value:_currentRadius==0?null:_currentRadius}],_currentParams);_load();_geoRetry=false}places.hottest=function(){_currentView="list";_currentSort="hottest";_currentStart=0;_load()};places.nearest=function(){_currentView="list";_currentSort="nearest";_currentStart=0;_load()};places.list=function(){_currentView="list";_currentStart=0;_load(false,true)};places.map=function(){_currentView="map";_currentStart=0;_load(false,true);_resizeMap()};places.doSearch=function(keywords){_currentQuery=keywords;_currentStart=0;_load()};places.widenSearch=function(radius){_currentRadius=radius;_currentStart=0;_load()};places.clearSearch=function(){if(_currentQuery=="*"){return}_currentQuery="*";_currentStart=0;_load()};places.clearFilters=function(){_currentStart=0;_currentParams=Query.mergeParams([{key:"tags",value:null}],_currentParams);_load()};places.more=function(){_currentStart=_currentStart+_itemsPerPage;_load(true)};places.refresh=function(){_currentStart=0;_load()};places.scroll=function(){SAF.scroll(_scrollTop)};var _imageState="";places.resize=function(){if($(window).width()<540){if(_imageState!="narrow"){_imageState="narrow";$("img.img","#places-list").removeAttr("height")}}else{_imageState="wide"}$(".content-primary","#places").width("auto");SAF.resizeIsotope("#places-list","li.place")};places.place=function(id){_scrollTop=$(window).scrollTop();SAF.Place.load(id,"places")};function _load(append,useCache){$.mobile.showPageLoadingMsg();if(!append){$("#places-list").empty();$(".more","#places").hide()}if(useCache&&_currentData!==null){_populate(_currentData);return}var callback=append===true?function(data){_populate(data,true)}:_populate;_currentParams=Query.mergeParams([{key:"sort",value:_currentSort}],_currentParams);Query.execute(_baseAPIUrl+"search/",_itemsPerPage,_currentStart,_currentQuery,_currentParams,callback)}function _populate(data,append){if(data){if(data.response){_currentData=data;var count=data.response.numFound;if(count==0){if(!append){$("#places-map").hide();$("#places-list").show();var msg="";if(_currentRadius>0){var btnText=_currentRadius>0?"Within "+_currentRadius+"KM":"All";msg="<p>Places are currently confined to a radius of <b><u>"+_currentRadius+"km</u></b> from your <b><u>current location</u></b>. Expend the search radius by selecting the <b><u>'"+btnText+"'</u></b> button above.</p>"}$("#places-list").html("<li class='loading'><h3>No results found.</h3>"+msg+"</li>")}$.mobile.hidePageLoadingMsg();return}if((_currentView=="list")&&(data.response.docs.length>0)&&(count>data.response.docs.length)){$(".more","#places").show()}else{$(".more","#places").hide()}if(_currentView=="list"){_populateList(data,append)}else{if(_currentView=="map"){_populateMap(data)}}}}else{SAF.alertError("Error. Please try again.")}}function _populateList(data,append){var html="";for(var i=0;i<data.response.docs.length;i++){var item=data.response.docs[i];var img="";if(item.images&&item.images.length>0){var imageHeight=" height='64px'";if($(window).width()>540){imageHeight=""}img='<img class="img" id="image-'+item.id+'" src="'+item.images[0]+'" align="right" width="100"'+imageHeight+'">'}var excerpt="";if(typeof(item.excerpt)!="undefined"){excerpt=item.excerpt}var email="";if(typeof(item.email)!="undefined"){email='<div class="prop"><a href="mailto:'+item.email+'">'+item.email+"</a></div>"}var tel="";if(typeof(item.contact)!="undefined"){tel='<div class="prop"><a href="tel:'+item.contact.replace("+27","").replace("(","").replace(")","")+'">'+item.contact+"</a></div>"}var addr="";if(typeof(item.address)!="undefined"){addr='<div class="prop">'+item.address+"</div>"}var first="";if(i==0){first=" first"}var hdr='<h3><span class="title">'+item.name+"</span></h3>";if($(window).width()<540){hdr=img+hdr}else{hdr=hdr+img}html+='<li class="place'+first+'"><a href="javascript:SAF.Places.place('+item.id+')"><div class="place-inner"><div class="place-container'+(append===true?" new":"")+'">'+hdr+'<div class="excerpt">'+excerpt+'</div></div><div class="meta-container">'+tel+email+addr+"</div></div></a></li>"}$("#places-map").hide();$("#places-list").show();if(append){SAF.isotopeIt("#places-list","li.place",true,html)}else{$("#places-list").html(html);SAF.isotopeIt("#places-list","li.place")}if($(window).width()>540){$("#places-list").bind("isotope",function(event){var width=$("li.place:first","#places-list").width();var columnCount=event.columnCount;var containerWidth=width*columnCount;if($(window).width()-containerWidth<200){$(".content-primary","#places").width(containerWidth+10)}})}$(".place","#places-list").each(function(){SAF.cleanElement($("span.title",this));SAF.cleanElement($(".excerpt",this))});$.mobile.hidePageLoadingMsg()}function _populateMap(data){SAF.loadGoogleMaps(function(){SAF.script("richmarker",function(){return typeof RichMarker!=="undefined"},function(){$("#places-map").show();$("#places-list").hide();if(!_map){_map=new google.maps.Map(document.getElementById("places-map"),{zoom:14,center:new google.maps.LatLng(_currentLat,_currentLng),mapTypeId:google.maps.MapTypeId.ROADMAP});_markerCluster=new MarkerClusterer(_map,[],{description:"Listings: click to show",maxZoom:12})}_clearMap();_displayLocation(_currentLat,_currentLng);for(var i=0;i<data.response.docs.length;i++){var item=data.response.docs[i];if(!item.geo_location){continue}var latLngArray=item.geo_location.split(",");var itemLatLng=new google.maps.LatLng(latLngArray[0],latLngArray[1]);if(i==0){_map.setCenter(itemLatLng)}var content="<div>"+item.name+"</div>";if(item.images&&item.images.length>0){content='<img id="image-'+item.id+'" src="'+item.images[0]+'" align="right" width="65" height="41">'}var marker=new RichMarker({position:itemLatLng,map:_map,draggable:false,flat:true,zindex:100,anchor:RichMarkerPosition.BOTTOM_LEFT,content:"<a href='javascript:SAF.Places.place("+item.id+")' class='overlay'>"+content+"</a>"});_mapMarkers.push(marker)}_markerCluster.addMarkers(_mapMarkers);$.mobile.hidePageLoadingMsg()})})}function _displayLocation(lat,lng){var latLng=new google.maps.LatLng(lat,lng);if(!_locationMarker){_locationMarker=new RichMarker({position:latLng,map:_map,draggable:false,flat:true,zIndex:9999,anchor:RichMarkerPosition.BOTTOM_LEFT,content:"<div id='location_marker'></div>"})}else{_locationMarker.setPosition(latLng)}_map.setCenter(latLng)}function _clearMap(){if(_mapMarkers){for(i in _mapMarkers){_mapMarkers[i].setMap(null)}_mapMarkers=[]}if(_markerCluster){_markerCluster.clearMarkers()}}function _resizeMap(){var header=$("header[data-role='header']:visible");var content=$("div[data-role='content']:visible:visible");var tabs=$(".tabs:visible");var subHeader=$(".sub-header:visible");var viewport_height=$(window).height();var content_height=viewport_height-header.outerHeight()-tabs.outerHeight()-subHeader.outerHeight()-70;$("#places-map").height(content_height)}return places})(SAF.Places||{});$(function(){SAF.Places.init()});SAF.Place=(function(place){var _baseAPIUrl="http://api.safindit.co.za/v1/place/";var _current=null;var _parentId=null;var _backTo="places";place.init=function(){SAF.registerPage("place",this)};place.back=function(){var delay=20;switch(_backTo){case"collection":SAF.Collection.load(_parentId);delay=1000;break;case"special":SAF.Special.load(_parentId);delay=1000;break;default:$.mobile.changePage("#"+_backTo,{reverse:true})}setTimeout(function(){switch(_backTo){case"places":SAF.Places.scroll();break;case"favorites":SAF.Favorites.scroll();break;case"collection":SAF.Collection.scroll();break;case"special":SAF.Special.scroll();break}},delay)};place.load=function(id,backTo,parentId){_backTo=backTo;_parentId=parentId;SAF.DB.saveState("place","view",id);$(".page-wrap","#place").hide();$.mobile.changePage("#place");setTimeout(function(){$.mobile.showPageLoadingMsg();Query.load(_baseAPIUrl+id,_populate)},20)};place.favorite=function(){if(_current){var item=_current;var excerpt="";if(typeof(item.excerpt)!="undefined"){excerpt=item.excerpt}var email="";if(typeof(item.email)!="undefined"){email=item.email}var tel="";if(typeof(item.contact)!="undefined"){tel=item.contact}var addr="";if(typeof(item.address)!="undefined"){addr=item.address}var img="";if(item.images&&item.images.length>0){img=item.images[0]}SAF.DB.favoritePlace(item.id,item.name,excerpt,email,tel,addr,img)}};place.unFavorite=function(){if(_current){SAF.DB.unFavoritePlace(_current.id)}};place.share=function(){if(_current){var item=_current;var excerpt="";if(typeof(item.excerpt)!="undefined"){excerpt=item.excerpt}SAF.Share.share(item.name,excerpt,"http://www.safindit.co.za/"+item.slug,function(){$.mobile.changePage("#place",{reverse:true})})}};function _populate(data){if(data){if(data.response){var count=data.response.numFound;if(count==1){var item=data.response.docs[0];_current=item;SAF.DB.isFavoritePlace(item.id,function(result){if(result){$("#place a[data-icon=favorite]").addClass("selected")}else{$("#place a[data-icon=favorite]").removeClass("selected")}});$("h1.main_title","#place").html(item.name);$(".description","#place").html(item.listing_description||"");_populateContactInfo(item);_populateSocial(item);_populateTags(item);_populatePhotos(item);SAF.cleanElement($("h1.main_title","#place"));$("a","#place .description").attr("target","_blank");$("iframe","#place .description").remove();$("object","#place .description").remove();$("#place .description").html(SAF.cleanHTML(_clean("#place .description")))}}}$(".page-wrap","#place").show();$.mobile.hidePageLoadingMsg()}function _populateSocial(item){var html="";if(item.twitter_social&&$.trim(item.twitter_social).length>"http://".length){html+="<div><img src='images/twitter.png' width='20' height='20' alt='Twitter'><a href='"+item.twitter_social+"' target='_blank'>"+item.twitter_social.replace("http://twitter.com/","").replace("http://www.twitter.com/","")+"</a></div>"}if(item.facebook_social&&$.trim(item.facebook_social).length>"http://".length){html+="<div><img src='images/facebook.png' width='20' height='20' alt='Facebook'><a href='"+item.facebook_social+"' target='_blank'>"+item.facebook_social.replace("http://facebook.com/","").replace("http://www.facebook.com/","")+"</a></div>"}if(item.gowalla_social){html+="<div><img src='images/gowalla.png' width='20' height='20' alt='Gowalla'><a href='http://gowalla.com/spots/"+item.gowalla_social+"' target='_blank'><span id='place-gowalla-checkins'></span>Gowalla check-ins</a></div>";_gowalla(item.gowalla_social)}if(item.foursquare_social){html+="<div><img src='images/foursquare.png' width='20' height='20' alt='Foursquare'><a href='http://foursquare.com/venue/"+item.foursquare_social+"' target='_blank'><span id='place-foursquare-checkins'></span>Foursquare check-ins</a></div>";html+="<div id='place-foursquare-mayor-container' style='display:none'><a id='place-foursquare-mayor-link' href='http://foursquare.com' target='_blank'><img src='images/mayor.png' width='16' height='16' alt='Foursquare' style='margin-left: 2px'/>&nbsp;Mayor: <u><span id='place-foursquare-mayor'></span></u></a></div>";_foursquare(item.foursquare_social)}$("div.social","#place").html(html)}function _populateContactInfo(item){var contactHtml="";if(item.contact){contactHtml+="<div><a href='tel:"+item.contact.replace("+27","")+"'>"+item.contact+"</a></div>"}if(item.website&&item.website.length>"http://".length){var url=$.trim(item.website);if(url.substr(0,"http://".length)!="http://"){url="http://"+item.website}contactHtml+="<div><a href='"+url+"' target='_blank'>"+url.replace("http://","")+"</a></div>"}if(item.email){contactHtml+="<div><a href='mailto:"+item.email+"'>"+item.email+"</a></div>"}var addressHtml="";if(item.address){addressHtml+="<div><a href='http://maps.google.com/maps?q="+item.address+"' target='_blank'>"+item.address+"</a></div>"}$("div.contact","#place").html(contactHtml);$("div.address","#place").html(addressHtml);if(item.geo_location){$("#place-map-link").attr("href","http://maps.google.com?q="+item.geo_location).html(item.geo_location+"<span>click to view map</span>")}}function _populateTags(item){if(item.tags&&item.tags.length>0){var tagHtml="";for(var i=0;i<item.tags.length;i++){tagHtml+="<div>"+item.tags[i]+"</div>"}$("div.tags","#place").parent().show();$("div.tags","#place").html(tagHtml)}else{$("div.tags","#place").parent().hide()}}function _populatePhotos(item){if(item.images&&item.images.length>0){$("div.photos","#place").parent().show();var photosHtml='<div class="gallery-row">';for(var i=0;i<item.images.length;i++){photosHtml+='<div class="gallery-item"><a href="'+item.images[i]+'"><img src="http://src.sencha.io/100/100/'+item.images[i]+'" alt="Image '+(i+1)+'" /></a></div>';if(i>0&&i%3==0){photosHtml+='</div><div class="gallery-row">'}if(i>8){break}}photosHtml+="</div>";$("div.photos","#place").html(photosHtml);$("div.photos a","#place").photoSwipe()}else{$("div.photos","#place").parent().hide()}}function _clean(element){var html=$(element).html().split("<h3>");var newHTML=new Array();for(i in html){if(i>0){var temp=html[i].split("</h3>");var insertData=$.trim(temp[1].replace(/\n/gi,""));var $insert=$("<span>"+insertData+"</span>");$(":empty",$insert).remove();if(insertData&&$insert.text().trim()!=""){newHTML[temp[0]]=insertData}}}var outputHTML="";for(i in newHTML){outputHTML+="<h3>"+i+"</h3>\n";outputHTML+=newHTML[i]+"\n"}return outputHTML}function _foursquare(vid){var foursquareClientId="B0N0H4CTQJ4BJCGFC1ZTJCC3RFUGUOHL4M4JGHOFB1AZSGQ1";$.getJSON("https://api.foursquare.com/v2/venues/"+vid+"?client_id="+foursquareClientId+"&client_secret=EF4PTHGEVH5SUHSRZX52ZCTBQRSZ0KKM144RJEFBLTOGVP50&callback=?",function(o){if(o){if(o.response){if(o.response.venue){var user,username;var venue=o.response.venue;if(venue.stats){$("#place-foursquare-checkins").html(venue.stats.checkinsCount+" ")}if(venue.mayor){if(venue.mayor.user){user=venue.mayor.user;username=user.firstName;if($.trim(user.lastName).length>0){username=username+" "+user.lastName}$("#place-foursquare-mayor-container").show();$("#place-foursquare-mayor").html(username);$("#place-foursquare-mayor-link").attr("href","http://foursquare.com/user/"+user.id)}}}}}})}function _gowalla(sid){$.getJSON("http://query.yahooapis.com/v1/public/yql?q=select%20checkins_count%20from%20gowalla.spots%20where%20id%3D"+sid+"%20and%20api_key%3D'fa574894bddc43aa96c556eb457b4009'%3B&format=json&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys&callback=?",function(o){if(o.query&&o.query.results&&o.query.results.json){var checkins=o.query.results.json.checkins_count;$("#place-gowalla-checkins").html(checkins+" ")}})}return place})(SAF.Place||{});$(function(){SAF.Place.init()});SAF.Favorites=(function(favorites){var _currentType="places";var _scrollTop=0;favorites.init=function(){SAF.registerPage("favorites",this)};favorites.open=function(){SAF.DB.saveState("favorites");SAF.Favorites.refresh()};favorites.load=function(type,id){_scrollTop=$(window).scrollTop();switch(type){case"news":SAF.Story.load(id,"favorites");break;case"magazine":SAF.Article.load(id,"favorites");break;case"places":SAF.Place.load(id,"favorites");break;case"collections":SAF.Collection.load(id,"favorites");break;case"specials":SAF.Special.load(id,null,"favorites");break}};favorites.places=function(){_currentType="places";SAF.DB.getFavoritePlaces(_populatePlaces)};favorites.collections=function(){_currentType="collections";SAF.DB.getFavoriteCollections(_populateCollections)};favorites.news=function(){_currentType="news";SAF.DB.getFavoriteStories(_populateNews)};favorites.magazine=function(){_currentType="magazine";SAF.DB.getFavoriteMagazineArticles(_populateMagazine)};favorites.specials=function(){_currentType="specials";SAF.DB.getFavoriteSpecials(_populateSpecials)};favorites.scroll=function(){SAF.scroll(_scrollTop)};favorites.refresh=function(){$.mobile.showPageLoadingMsg();$("#favorite-list").empty();$(".more","#favorites").hide();setTimeout(function(){switch(_currentType){case"news":SAF.Favorites.news();break;case"magazine":SAF.Favorites.magazine();break;case"collections":SAF.Favorites.collections();break;case"specials":SAF.Favorites.specials();break;default:SAF.Favorites.places()}},250)};var _placesImageState="";var _magImageState="";favorites.resize=function(){switch(_currentType){case"places":if($(window).width()<540){if(_placesImageState!="narrow"){_placesImageState="narrow";$("img.img","#favorites-list").removeAttr("height")}}else{_placesImageState="wide"}SAF.resizeIsotope("#favorites-list","li.place");break;case"news":SAF.resizeIsotope("#favorite-list","li.article");break;case"magazine":case"collections":case"specials":if($(window).width()<540){if(_magImageState!="narrow"){_magImageState="narrow";$("img.img","#favorites-list").removeAttr("height")}}else{_magImageState="wide"}SAF.resizeIsotope("#favorites-list","li.article");break;default:this.places()}};function _deletePlaces(){$(".more","#favorites").unbind("click").click(_confirmDeletePlaces).find("div").html("Are you sure?")}function _confirmDeletePlaces(){SAF.DB.deleteFavoritePlaces(function(){SAF.Favorites.places()})}function _deleteNews(){$(".more","#favorites").unbind("click").click(_confirmDeleteNews).find("div").html("Are you sure?")}function _confirmDeleteNews(){SAF.DB.deleteFavoriteStories(function(){SAF.Favorites.news()})}function _deleteMagazine(){$(".more","#favorites").unbind("click").click(_confirmDeleteMagazine).find("div").html("Are you sure?")}function _confirmDeleteMagazine(){SAF.DB.deleteFavoriteMagazineArticles(function(){SAF.Favorites.magazine()})}function _deleteCollections(){$(".more","#favorites").unbind("click").click(_confirmDeleteCollections).find("div").html("Are you sure?")}function _confirmDeleteCollections(){SAF.DB.deleteFavoriteCollections(function(){SAF.Favorites.collections()})}function _deleteSpecials(){$(".more","#favorites").unbind("click").click(_confirmDeleteSpecials).find("div").html("Are you sure?")}function _confirmDeleteSpecials(){SAF.DB.deleteFavoriteSpecials(function(){SAF.Favorites.specials()})}function _populateNews(favorites){if(favorites.length==0){$("#favorite-list").html("<li class='message'><p>No favorite news articles!</p><p>That's hard to believe! Safindit has the latest and hottest news from over 80 South African news sources. <a href='#news'>Click here</a> to catchup on the day's news. You're bound to like at least a couple stories. We know you will.</p></li>");$(".more","#favorites").hide();$.mobile.hidePageLoadingMsg();return}var html="";for(var i=0;i<favorites.length;i++){var item=favorites[i];var domain="";if(typeof(item.domain)!="undefined"){domain='<div class="tag"><span class="'+item.domain+'">'+item.domain.substr(0,1)+"</span></div>"}var excerpt="";if(typeof(item.excerpt)!="undefined"){excerpt=item.excerpt}html+='<li class="article" id="'+item.id+"\"><a href=\"javascript:SAF.Favorites.load('news', '"+item.id+'\')"><div class="article-inner"><div class="article-container"><h3>'+domain+'<span class="title">'+item.title+'</span></h3><div class="prop">'+prettyDate(item.datetime)+" on "+item.source+'</div><p class="excerpt">'+excerpt+"</p></div></div></a></li>"}$("#favorite-list").html(html);SAF.isotopeIt("#favorite-list","li.article");if(favorites.length>0){$(".more","#favorites").unbind("click").click(_deleteNews).show().find("div").html("Delete All")}else{$(".more","#favorites").hide()}$(".article","#favorite-list").each(function(){SAF.cleanElement($("span.title",this));SAF.cleanElement($("p.excerpt",this))});$.mobile.hidePageLoadingMsg()}function _populateMagazine(favorites){if(favorites.length==0){$("#favorite-list").html("<li class='message'><p>No favorite magazine articles!</p><p>You're really missing out. <a href='#magazine'>Click here</a> to read the stories behind some of your favorites places.</p></li>");$(".more","#favorites").hide();$.mobile.hidePageLoadingMsg();return}var html="";for(var i=0;i<favorites.length;i++){var item=favorites[i];var excerpt="";if(typeof(item.excerpt)!="undefined"){excerpt=item.excerpt}var img="";if(item.image){var imageHeight=" height='64'";if($(window).width()>540){imageHeight=""}img='<img class="img" id="image-'+item.id+'" src="'+item.image+'" align="right" width="100"'+imageHeight+'">'}var hdr='<h3><span class="title">'+item.title+"</span></h3>";if($(window).width()<540){hdr=img+hdr}else{hdr=hdr+img}html+='<li class="article"><a href="javascript:SAF.Favorites.load(\'magazine\', '+item.id+')"><div class="article-inner"><div class="article-container">'+hdr+'<div class="prop">'+prettyDate(item.datetime)+'</div><div class="excerpt">'+excerpt+"</div></div></div></a></li>"}$("#favorite-list").html(html);SAF.isotopeIt("#favorite-list","li.article");if(favorites.length>0){$(".more","#favorites").unbind("click").click(_deleteMagazine).show().find("div").html("Delete All")}else{$(".more","#favorites").hide()}$(".article","#favorite-list").each(function(){SAF.cleanElement($("span.title",this));SAF.cleanElement($("p.excerpt",this))});$.mobile.hidePageLoadingMsg()}function _populatePlaces(favorites){if(favorites.length==0){$("#favorite-list").html("<li class='message'><p>No favorite places!</p><p>There must be somewhere you like. <a href='#places'>Click here</a> to discover the shweetest places around.</p></li>");$(".more","#favorites").hide();$.mobile.hidePageLoadingMsg();return}var html="";for(var i=0;i<favorites.length;i++){var item=favorites[i];var img="";var imgWidth=(SAF.os.ipad||$(window).width()>600)?220:100;if(item.image){img='<img src="'+item.image+'" align="right" width="'+imgWidth+'">'}var img="";if(item.image){var imageHeight=" height='64px'";if($(window).width()>540){imageHeight=""}img='<img class="img" id="image-'+item.id+'" src="'+item.image+'" align="right" width="100"'+imageHeight+'">'}var email="";if(typeof(item.email)!="undefined"){email='<div class="prop"><a href="mailto:'+item.email+'">'+item.email+"</a></div>"}var tel="";if(typeof(item.tel)!="undefined"){tel='<div class="prop"><a href="tel:'+item.tel.replace("+27","").replace("(","").replace(")","")+'">'+item.tel+"</a></div>"}var addr="";if(typeof(item.address)!="undefined"){addr='<div class="prop">'+item.address+"</div>"}var first="";if(i==0){first=" first"}var hdr='<h3><span class="title">'+item.name+"</span></h3>";if($(window).width()<540){hdr=img+hdr}else{hdr=hdr+img}html+='<li class="place '+first+"\"><a href=\"javascript:SAF.Favorites.load('places', "+item.id+')"><div class="place-inner"><div class="place-container">'+hdr+'<div class="excerpt">'+item.excerpt+'</div></div><div class="meta-container">'+tel+email+addr+"</div></div></div></a></li>"}$("#favorite-list").html(html);SAF.isotopeIt("#favorite-list","li.place");if(favorites.length>0){$(".more","#favorites").unbind("click").click(_deletePlaces).show().find("div").html("Delete All")}else{$(".more","#favorites").hide()}$(".place","#favorite-list").each(function(){SAF.cleanElement($("span.title",this));SAF.cleanElement($("p.excerpt",this))});$.mobile.hidePageLoadingMsg()}function _populateCollections(favorites){if(favorites.length==0){$("#favorite-list").html("<li class='message'><p>No favorite collections!</p><p>You don't know what you are missing out on! Our team of gurus (and the occasional celeb) spend hours collecting the best places just for you. <a href='#news'>Click here</a> to browse our collections. There's gold in 'm hills!</p></li>");$(".more","#favorites").hide();$.mobile.hidePageLoadingMsg();return}var html="";for(var i=0;i<favorites.length;i++){var item=favorites[i];var img="";if(item.image){var imageHeight=" height='64'";if($(window).width()>540){imageHeight=" height='140'"}img='<img class="img" id="image-'+item.id+'" src="'+item.image+'" align="right" width="100"'+imageHeight+">"}var excerpt="";if(typeof(item.excerpt)!="undefined"){excerpt=item.excerpt}var hdr='<h3><span class="title">'+item.title+"</span></h3>";if($(window).width()<540){hdr=img+hdr}else{hdr=hdr+img}html+="<li class=\"article collection\"><a href=\"javascript:SAF.Favorites.load('collections', '"+item.id+'\')"><div class="article-inner"><div class="article-container">'+hdr+'<div class="count">'+item.count+' Listings</div><div class="excerpt">'+excerpt+"</div></div></div></a></li>"}$("#favorite-list").html(html);SAF.isotopeIt("#favorite-list","li.article");if(favorites.length>0){$(".more","#favorites").unbind("click").click(_deleteCollections).show().find("div").html("Delete All")}else{$(".more","#favorites").hide()}$(".article","#favorite-list").each(function(){SAF.cleanElement($("span.title",this));SAF.cleanElement($("p.excerpt",this))});$.mobile.hidePageLoadingMsg()}function _populateSpecials(favorites){if(favorites.length==0){$("#favorite-list").html("<li class='message'><p>No favorite specials!</p><p>Everyone, yes, everyone loves a good deal! <a href='#news'>Click here</a> to the current specials nearest to you and save, save and save.</p></li>");$(".more","#favorites").hide();$.mobile.hidePageLoadingMsg();return}var html="";for(var i=0;i<favorites.length;i++){var item=favorites[i];var img="";if(item.image){var imageHeight=" height='64'";if($(window).width()>540){imageHeight=" height='140'"}img='<img class="img" id="image-'+item.id+'" src="'+item.image+'" align="right" width="100"'+imageHeight+">"}var excerpt="";if(typeof(item.excerpt)!="undefined"){excerpt=item.excerpt}var hdr='<h3><span class="title">'+item.title+"</span></h3>";if($(window).width()<540){hdr=img+hdr}else{hdr=hdr+img}html+="<li class=\"article special\"><a href=\"javascript:SAF.Favorites.load('specials', '"+item.id+'\')"><div class="article-inner"><div class="article-container">'+hdr+'<div class="prop">'+item.dates+'</div><div class="prop">'+item.location+'</div><div class="excerpt">'+excerpt+"</div></div></div></a></li>"}$("#favorite-list").html(html);SAF.isotopeIt("#favorite-list","li.article");if(favorites.length>0){$(".more","#favorites").unbind("click").click(_deleteSpecials).show().find("div").html("Delete All")}else{$(".more","#favorites").hide()}$(".article","#favorite-list").each(function(){SAF.cleanElement($("span.title",this));SAF.cleanElement($("p.excerpt",this))});$.mobile.hidePageLoadingMsg()}return favorites})(SAF.Favorites||{});$(function(){SAF.Favorites.init()});SAF.Collections=(function(collections){var _baseAPIUrl="http://api.safindit.co.za/v1/collection/";var _currentParams=[];var _currentQuery="*";var _itemsPerPage=20;var _currentStart=0;var _scrollTop=0;var _loaded=false;collections.init=function(){SAF.registerPage("collections",this)};collections.open=function(){if(!_loaded){_load();_loaded=true}SAF.DB.saveState("collections")};collections.more=function(){_currentStart=_currentStart+_itemsPerPage;_load(true)};collections.refresh=function(){_currentStart=0;_load()};collections.doSearch=function(keywords){_currentQuery=keywords;_currentStart=0;_load()};collections.clearSearch=function(){if(_currentQuery=="*"){return}_currentQuery="*";_currentStart=0;_load()};collections.scroll=function(){SAF.scroll(_scrollTop)};var _imageState="";collections.resize=function(){if($(window).width()<540){if(_imageState!="narrow"){_imageState="narrow";$("img.img","#collections-list").removeAttr("height")}}else{_imageState="wide"}$(".content-primary","#collections").width("auto");SAF.resizeIsotope("#collections-list","li.article")};collections.load=function(id){_scrollTop=$(window).scrollTop();SAF.Collection.load(id,"collections")};function _load(append){$.mobile.showPageLoadingMsg();if(!append){$("#collections-list").empty();$(".more","#collections").hide()}_currentParams=Query.mergeParams([{key:"sort",value:"timestamp"}],_currentParams);var callback=append===true?function(data){_populate(data,true)}:_populate;Query.execute(_baseAPIUrl+"search/",_itemsPerPage,_currentStart,_currentQuery,_currentParams,callback)}function _populate(data,append){if(data){if(data.response){var count=data.response.numFound;if(count==0){if(!append){$("#collections-list").html("<li class='loading'><h3>No collections found.</h3></li>")}$.mobile.hidePageLoadingMsg();return}if((data.response.docs.length>0)&&(count>data.response.docs.length)){$(".more","#collections").html("<div>More</div>").show()}else{$(".more","#collections").hide()}var html="";for(var i=0;i<data.response.docs.length;i++){var item=data.response.docs[i];var img="";if(item.images&&item.images.length>0){var imageHeight=" height='64'";if($(window).width()>540){imageHeight=" height='140'"}img='<img class="img" id="image-'+item.id+'" src="'+item.images[0]+'" align="right" width="100"'+imageHeight+">"}var count=0;if(typeof(item.listing_id)!="undefined"){var listingIds=item.listing_id.split(",");count=listingIds.length}var excerpt="";if(item.excerpt&&typeof(item.excerpt)!="undefined"){excerpt=item.excerpt}var hdr='<h3><span class="title">'+item.name+"</span></h3>";if($(window).width()<540){hdr=img+hdr}else{hdr=hdr+img}html+='<li class="article collection"><a href="javascript:SAF.Collections.load('+item.id+')"><div class="article-inner"><div class="article-container'+(append===true?" new":"")+'">'+hdr+'<div class="count">'+count+' Listings</div><div class="excerpt">'+excerpt+"</div></div></div></a></li>"}if(append){SAF.isotopeIt("#collections-list","li.article",true,html)}else{$("#collections-list").html(html);SAF.isotopeIt("#collections-list","li.article")}if($(window).width()>540){$("#collections-list").bind("isotope",function(event){var width=$("li.article:first","#collections-list").width();var columnCount=event.columnCount;var containerWidth=width*columnCount;if($(window).width()-containerWidth<200){$(".content-primary","#collections").width(containerWidth+10)}})}$(".article","#collections-list").each(function(){SAF.cleanElement($("span.title",this));SAF.cleanElement($("p.excerpt",this))})}}else{SAF.alertError("Error. Please try again.")}$.mobile.hidePageLoadingMsg()}return collections})(SAF.Collections||{});$(function(){SAF.Collections.init()});SAF.Collection=(function(collection){var _baseAPIUrl="http://api.safindit.co.za/v1/collection/";var _current=null;var _backTo="collections";var _currentQuery="*";var _currentParams=[];var _currentPerPage=20;var _currentStart=0;var _scrollTop=0;collection.init=function(){SAF.registerPage("collection",this);if($(window).width()>540){_currentPerPage=50}};collection.load=function(id,backTo){if(backTo){_backTo=backTo}SAF.DB.saveState("collection","view",id);$("#collection-content").empty();$("#collection-places-list").empty();$(".more","#collection").hide();$.mobile.changePage("#collection");setTimeout(function(){$.mobile.showPageLoadingMsg();Query.load(_baseAPIUrl+id,_populate)},20)};collection.place=function(id){_scrollTop=$(window).scrollTop();SAF.Place.load(id,"collection",_current.id)};collection.more=function(){_currentStart=_currentStart+_currentPerPage;_loadListings(true)};collection.back=function(){$.mobile.changePage("#"+_backTo,{reverse:true});setTimeout(function(){if(_backTo=="collections"){SAF.Collections.scroll()}else{if(_backTo=="favorites"){SAF.Favorites.scroll()}}},1000)};collection.share=function(){if(_current){var url="http://www.safindit.co.za/collections/"+_current.slug;SAF.Share.share(_current.name,_current.excerpt,url,function(){SAF.Collection.load(_current.id,_backTo)})}};collection.favorite=function(){if(_current){var col=_current;var img="";if(col.images&&col.images.length>0){img=col.images[0]}var count=0;if(typeof(col.listing_id)!="undefined"){var listingIds=col.listing_id.split(",");count=listingIds.length}SAF.DB.favoriteCollection(col.id,col.name,col.excerpt,img,count,col.timestamp)}};collection.unFavorite=function(){if(_current){SAF.DB.unFavoriteCollection(_current.id)}};collection.scroll=function(){SAF.scroll(_scrollTop)};var _imageState="";collection.resize=function(){if($(window).width()<540){if(_imageState!="narrow"){_imageState="narrow";$("img.img","#collection-places-list").removeAttr("height")}}else{_imageState="wide"}SAF.resizeIsotope("#collection-places-list","li.place")};function _populate(data){if(data){if(data.response){var count=data.response.numFound;if(count==1){var item=data.response.docs[0];_current=item;SAF.DB.isFavoriteCollection(item.id,function(result){if(result){$("#collection a[data-icon=favorite]").addClass("selected")}else{$("#collection a[data-icon=favorite]").removeClass("selected")}});var count=0;if(typeof(item.listing_id)!="undefined"){var listingIds=item.listing_id.split(",");count=listingIds.length;$("span.count","#collection-places-header").html(count+"&nbsp;");$("#collection-places-header").show();_loadListings(false)}else{$("#collection-places-list").html("<li class='loading'><h3>No places found for collection.</h3></li>");$.mobile.hidePageLoadingMsg()}var img="";if(item.images&&item.images.length>0){img='<img name="col-img" src="'+item.images[0]+'" width="298">'}var html='<div class="article single"><div class="article-inner"><div class="article-container"><h3><span class="title">'+item.name+"</span></h3>"+img+'<div class="excerpt">'+item.listing_description+"</div></div></div></div>";var $content=$("#collection-content");var d=$(html);$("img[name!=col-img]",d).remove();$content.html(d);$("span.title",$content).html($("span.title",$content).text());$("a",$content).attr("target","_blank");$("img[name!=col-img]",$content).remove()}else{$("#collection-content").html("<li class='loading'><h3>Collection not found.</h3></li>")}}}}function _loadListings(append){if(_current){$.mobile.showPageLoadingMsg();var callback=append===true?function(data){_populateListings(data,true)}:_populateListings;_currentParams=Query.mergeParams([{key:"sort",value:"hottest"},{key:"collectionID",value:_current.id}],_currentParams);Query.execute("http://api.safindit.co.za/v1/place/search/",_currentPerPage,_currentStart,_currentQuery,_currentParams,callback)}}function _populateListings(data,append){if(data){if(data.response){var count=data.response.numFound;if(count==0){if(!append){$("#collection-places-list").empty()}$.mobile.hidePageLoadingMsg();return}if((data.response.docs.length>0)&&(count>data.response.docs.length)){$(".more","#collection").html("<div>More</div>").show()}else{$(".more","#collection").hide()}_populateListingsList(data,append)}}else{SAF.alertError("Error. Please try again.")}$.mobile.hidePageLoadingMsg()}function _populateListingsList(data,append){var html="";for(var i=0;i<data.response.docs.length;i++){var item=data.response.docs[i];var img="";if(item.images&&item.images.length>0){var imageHeight=" height='64px'";if($(window).width()>540){imageHeight=""}img='<img class="img" id="image-'+item.id+'" src="'+item.images[0]+'" align="right" width="100"'+imageHeight+'">'}var excerpt="";if(typeof(item.excerpt)!="undefined"){excerpt=item.excerpt}var email="";if(typeof(item.email)!="undefined"){email='<div class="prop"><a href="mailto:'+item.email+'">'+item.email+"</a></div>"}var tel="";if(typeof(item.contact)!="undefined"){tel='<div class="prop"><a href="tel:'+item.contact.replace("+27","").replace("(","").replace(")","")+'">'+item.contact+"</a></div>"}var addr="";if(typeof(item.address)!="undefined"){addr='<div class="prop">'+item.address+"</div>"}var first="";if(i==0){first=" first"}if(i==data.response.docs.length-1){first=" last"}var hdr='<h3><span class="title">'+item.name+"</span></h3>";if($(window).width()<540){hdr=img+hdr}else{hdr=hdr+img}html+='<li class="place'+first+'"><a href="javascript:SAF.Collection.place('+item.id+')"><div class="place-inner"><div class="place-container'+(append===true?" new":"")+'">'+hdr+'<div class="excerpt">'+excerpt+'</div></div><div class="meta-container">'+tel+email+addr+"</div></div></a></li>"}if(append){SAF.isotopeIt("#collection-places-list","li.place",true,html)}else{$("#collection-places-list").html(html);SAF.isotopeIt("#collection-places-list","li.place")}if($(window).width()>540){$("#collection-places-list").bind("isotope",function(event){var width=$("li.place:first","#collection-places-list").width();var columnCount=event.columnCount;var containerWidth=width*columnCount;if($(window).width()-containerWidth<200){$(".content-primary","#collection").width(containerWidth+10)}})}$(".place","#collection-places-list").each(function(){SAF.cleanElement($("span.title",this));SAF.cleanElement($(".excerpt",this))});$.mobile.hidePageLoadingMsg()}return collection})(SAF.Collection||{});$(function(){SAF.Collection.init()});SAF.Magazine=(function(magazine){var _baseAPIUrl="http://api.safindit.co.za/v1/magazine/";var _currentParams=[];var _currentQuery="*";var _itemsPerPage=20;var _currentStart=0;var _scrollTop=0;var _loaded=false;magazine.init=function(){SAF.registerPage("magazine",this)};magazine.open=function(){if(!_loaded){_load();_loaded=true}SAF.DB.saveState("magazine")};magazine.more=function(){_currentStart=_currentStart+_itemsPerPage;_load(true)};magazine.refresh=function(){_currentStart=0;_load()};magazine.doSearch=function(keywords){_currentQuery=keywords;_currentStart=0;_load()};magazine.clearSearch=function(){if(_currentQuery=="*"){return}_currentQuery="*";_currentStart=0;_load()};magazine.read=function(id){_scrollTop=$(window).scrollTop();$("#m"+id).addClass("read");SAF.Article.load(id,"magazine")};magazine.scroll=function(){SAF.scroll(_scrollTop)};var _imageState="";magazine.resize=function(){if($(window).width()<540){if(_imageState!="narrow"){_imageState="narrow";$("img.img","#magazine-list").removeAttr("height")}}else{_imageState="wide"}$(".content-primary","#magazine").width("auto");SAF.resizeIsotope("#magazine-list","li.article")};function _load(append){$.mobile.showPageLoadingMsg();if(!append){$("#magazine-list").empty();$(".more","#magazine").hide()}_currentParams=Query.mergeParams([{key:"sort",value:"timestamp"}],_currentParams);var callback=append===true?function(data){_populate(data,true)}:_populate;Query.execute(_baseAPIUrl+"search/",_itemsPerPage,_currentStart,_currentQuery,_currentParams,callback)}function _populate(data,append){if(data){if(data.response){var count=data.response.numFound;if(count==0){if(!append){$("#magazine-list").html("<li class='loading'><h3>No magazine articles found.</h3></li>")}$.mobile.hidePageLoadingMsg();return}if((data.response.docs.length>0)&&(count>data.response.docs.length)){$(".more","#magazine").show()}else{$(".more","#magazine").hide()}var html="";for(var i=0;i<data.response.docs.length;i++){var item=data.response.docs[i];var img="";if(item.images&&item.images.length>0){var imageHeight=" height='64'";if($(window).width()>540){imageHeight=""}img='<img class="img" id="image-'+item.id+'" src="'+item.images[0]+'" align="right" width="100"'+imageHeight+'">'}var excerpt="";if(typeof(item.excerpt)!="undefined"){excerpt=item.excerpt}var hdr='<h3><span class="title">'+item.name+"</span></h3>";if($(window).width()<540){hdr=img+hdr}else{hdr=hdr+img}html+='<li class="article" id="m'+item.id+'"><a href="javascript:SAF.Magazine.read('+item.id+')"><div class="article-inner"><div class="article-container'+(append===true?" new":"")+'">'+hdr+'<div class="prop">'+prettyDate(item.timestamp)+'</div><div class="excerpt">'+excerpt+"</div></div></div></a></li>"}if(append){SAF.isotopeIt("#magazine-list","li.article",true,html)}else{$("#magazine-list").html(html);SAF.isotopeIt("#magazine-list","li.article")}if($(window).width()>540){$("#magazine-list").bind("isotope",function(event){var width=$("li.article:first","#magazine-list").width();var columnCount=event.columnCount;var containerWidth=width*columnCount;if($(window).width()-containerWidth<200){$(".content-primary","#magazine").width(containerWidth+10)}})}_setRead();$(".article","#magazine-list").each(function(){SAF.cleanElement($("span.title",this));SAF.cleanElement($("p.excerpt",this))})}}else{SAF.alertError("Error. Please try again.")}$.mobile.hidePageLoadingMsg()}function _setRead(){SAF.DB.getReadMagazineArticles(function(reads){for(var i=0;i<reads.length;i++){$("#m"+reads[i].id).addClass("read")}})}return magazine})(SAF.Magazine||{});$(function(){SAF.Magazine.init()});SAF.Story=(function(story){var _baseAPIUrl="http://api.safindit.co.za/v1/news/";var _current=null;var _backTo="news";story.init=function(){SAF.registerPage("story",this)};story.load=function(id,backTo){_backTo=backTo;SAF.DB.saveState("news-read","view",id);$(".page-wrap","#story").hide();$(".more","#story").hide();$.mobile.changePage("#story");setTimeout(function(){$.mobile.showPageLoadingMsg();Query.load(_baseAPIUrl+id.toUpperCase(),_populate);Query.load(_baseAPIUrl+"read/"+id.toUpperCase())},20)};story.share=function(){if(_current){var url="http://safindit.co.za/read/?v="+_current.id.toLowerCase();SAF.Share.share(_current.name,_current.excerpt,url,function(){SAF.Story.load(_current.id,_backTo)})}};story.favorite=function(){if(_current){SAF.DB.favoriteStory(_current.id,_current.name,_current.excerpt,_current.source,_current.domain,_current.timestamp)}};story.unFavorite=function(){if(_current){SAF.DB.unFavoriteStory(_current.id)}};story.back=function(){$.mobile.changePage("#"+_backTo,{reverse:true});setTimeout(function(){if(_backTo=="news"){SAF.News.scroll()}else{if(_backTo=="favorites"){SAF.Favorites.scroll()}}},20)};function _populate(data){if(data){if(data.response){var count=data.response.numFound;if(count==1){var item=data.response.docs[0];_current=item;SAF.DB.readStory(item.id);SAF.DB.isFavoriteStory(item.id,function(result){if(result){$("#story a[data-icon=favorite]").addClass("selected")}else{$("#story a[data-icon=favorite]").removeClass("selected")}});var img="";if(item.imageheight_flag=="1"){img='<img name="story-img" data-story-id="'+item.id+'" class="img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==" width="220" height="'+item.imageheight+'">';$(".image","#story").html(img)}var domain="";if(typeof(item.domain)!="undefined"){domain='<div class="tag"><span class="'+item.domain+'">'+item.domain+"</span></div>"}$("h1.main_title","#story").html(item.name);$(".details","#story").html('<div class="prop">'+item.age+' on <span class="source">'+item.source+"</span></div>"+domain);$(".description","#story").html(item.listing_description||"");_populateSocial(item);if(item.imageheight_flag=="1"){SAF.News.loadImage(item.id,"#story-content")}var $top=$(".more","#story");$top.show();if(SAF.isInView($top)){$top.hide()}else{$top.show()}SAF.cleanElement($("h1.main_title","#story"));$("a","#story .description").attr("target","_blank");$("iframe","#story .description").remove();$("object","#story .description").remove();$("img[name!=story-img]","#story .description").remove()}else{$("#story-content").html("<li class='loading'><h3>Story not found.</h3></li>")}}}$(".page-wrap","#story").show();$.mobile.hidePageLoadingMsg()}function _populateSocial(item){var twitter=" Twitter Mention";if(item.twitter!=1){twitter+="s"}var fb=" Facebook Likes or Shares";if(item.facebook==1){fb=" Facebook Like or Share"}var saf=" Safindit Read";if(item.read!=1){saf+="s"}var html="";html+="<div><img src='images/saf.png' width='20' height='20' alt='Safindit'><a href='javascript:;'>"+item.read+saf+"</a></div>";html+="<div><img src='images/twitter.png' width='20' height='20' alt='Twitter'><a href='javascript:;'>"+item.twitter+twitter+"</a></div>";html+="<div><img src='images/facebook.png' width='20' height='20' alt='Facebook'><a href='javascript:;'>"+item.facebook+fb+"</a></div>";$("div.social","#story").html(html)}return story})(SAF.Story||{});$(function(){SAF.Story.init()});SAF.Article=(function(article){var _baseAPIUrl="http://api.safindit.co.za/v1/magazine/";var _current=null;var _backTo="magazine";article.init=function(){SAF.registerPage("article",this)};article.load=function(id,backTo){_backTo=backTo;SAF.DB.saveState("magazine-read","view",id);$("#article-content").empty();$(".more","#article").hide();$.mobile.changePage("#article");setTimeout(function(){$.mobile.showPageLoadingMsg();Query.load(_baseAPIUrl+id,_populate)},20)};article.share=function(){if(_current){var url="http://www.safindit.co.za/"+_current.slug;if(url.length>0){SAF.Share.share(_current.name,_current.excerpt,url,function(){SAF.Article.load(_current.id,_backTo)})}else{$.mobile.changePage("#magazine",{reverse:true})}}};article.favorite=function(){if(_current){var img="";if(_current.images&&_current.images.length>0){img=_current.images[0]}SAF.DB.favoriteMagazineArticle(_current.id,_current.name,_current.excerpt,img,_current.timestamp)}};article.unFavorite=function(){if(_current){SAF.DB.unFavoriteMagazineArticle(_current.id)}};article.back=function(){$.mobile.changePage("#"+_backTo,{reverse:true});setTimeout(function(){if(_backTo=="magazine"){SAF.Magazine.scroll()}else{if(_backTo=="favorites"){SAF.Favorites.scroll()}}},20)};function _populate(data){if(data){if(data.response){var count=data.response.numFound;if(count==1){var item=data.response.docs[0];_current=item;SAF.DB.readMagazineArticle(item.id);SAF.DB.isFavoriteMagazineArticle(item.id,function(result){if(result){$("#article a[data-icon=favorite]").addClass("selected")}else{$("#article a[data-icon=favorite]").removeClass("selected")}});var img="";if(item.images&&item.images.length>0){img='<img name="mag-img" src="'+item.images[0]+'" width="220">'}var html='<div class="article single"><div class="article-inner"><div class="article-container"><h3><span class="title">'+item.name+"</span></h3>"+img+'<div class="prop">'+prettyDate(item.timestamp)+'</div><div class="excerpt">'+item.listing_description+"</div></div></div></div>";var $content=$("#article-content");var d=$(html);$("img[name!=mag-img]",d).remove();$content.html(d);var $top=$(".more","#article");$top.show();if(SAF.isInView($top)){$top.hide()}else{$top.show()}SAF.cleanElement($("span.title",$content));$("a",$content).attr("target","_blank");$("img[name!=mag-img]",$content).remove()}else{$("#article-content").html("<li class='loading'><h3>Article not found.</h3></li>")}}}$.mobile.hidePageLoadingMsg()}return article})(SAF.Article||{});$(function(){SAF.Article.init()});SAF.Specials=(function(specials){var _baseAPIUrl="http://api.safindit.co.za/v1/special/";var _currentParams=[];var _currentQuery="*";var _itemsPerPage=20;var _currentStart=0;var _currentRadius=5;var _currentLat=-30.448674;var _currentLng=24.389648;var _currentWhen="current";var _scrollTop=0;var _loaded=false;var _geoRetry=false;specials.init=function(){SAF.registerPage("specials",this);if($(window).width()>1000){_itemsPerPage=50}};specials.open=function(){if(!_loaded){if(!SAF.Settings.loaded){SAF.Settings.init(function(){_open()})}else{_open()}}SAF.DB.saveState("places")};function _open(){_currentRadius=SAF.Settings.specialsRadius;SAF.setGeoSelect("specials",_currentRadius,function(){_currentRadius=parseInt($(this).val(),10);SAF.Settings.specialsRadius=_currentRadius;SAF.Settings.save();SAF.Specials.geo()});SAF.Specials.geo();_loaded=true}specials.geo=function(){if(navigator.geolocation){$.mobile.showPageLoadingMsg();navigator.geolocation.getCurrentPosition(function(position){var latLng=position.coords.latitude+","+position.coords.longitude;_currentLat=position.coords.latitude;_currentLng=position.coords.longitude;_geo(latLng)},function(error){if(!_geoRetry){_geoRetry=true;SAF.Specials.geo()}},{enableHighAccuracy:true,maximumAge:300000,timeout:10000})}else{SAF.locateUser(function(position){var latLng=position.lat+","+position.lng;_currentLat=position.coords.latitude;_currentLng=position.coords.longitude;_geo(latLng)})}};function _geo(latLng){_currentStart=0;_currentParams=Query.mergeParams([{key:"geo",value:_currentRadius==0?null:latLng},{key:"distance",value:_currentRadius==0?null:_currentRadius}],_currentParams);_load();_geoRetry=false}specials.current=function(){_currentWhen="current";_currentStart=0;_load()};specials.past=function(){_currentWhen="past";_currentStart=0;_load()};specials.more=function(){_currentStart=_currentStart+_itemsPerPage;_load(true)};specials.refresh=function(){_currentStart=0;_load()};specials.doSearch=function(keywords){_currentQuery=keywords;_currentStart=0;_load()};specials.clearSearch=function(){if(_currentQuery=="*"){return}_currentQuery="*";_currentStart=0;_load()};specials.filterByCategory=function(category){if(category=="All"){category=null}_currentStart=0;_currentParams=Query.mergeParams([{key:"tags",value:category}],_currentParams);_load()};specials.scroll=function(){SAF.scroll(_scrollTop)};var _imageState="";specials.resize=function(){if($(window).width()<540){if(_imageState!="narrow"){_imageState="narrow";$("img.img","#specials-list").removeAttr("height")}}else{_imageState="wide"}$(".content-primary","#specials").width("auto");SAF.resizeIsotope("#specials-list","li.article")};specials.load=function(id){_scrollTop=$(window).scrollTop();var location=$("#special-"+id,"#specials-list").find("div[data-listing-id]").html();SAF.Special.load(id,location,"specials")};function _load(append){$.mobile.showPageLoadingMsg();if(!append){$("#specials-list").empty();$(".more","#specials").hide()}_currentParams=Query.mergeParams([{key:"when",value:_currentWhen}],_currentParams);var callback=append===true?function(data){_populate(data,true)}:_populate;if(Query.hasKey(_currentParams,"geo")){_currentParams=Query.mergeParams([{key:"secondSearch",value:_currentQuery}],_currentParams);Query.execute(_baseAPIUrl+"search/location/",_itemsPerPage,_currentStart,"custom",_currentParams,callback)}else{Query.execute(_baseAPIUrl+"search/",_itemsPerPage,_currentStart,_currentQuery,_currentParams,callback)}}function _populate(data,append){if(data){if(data.response){var count=data.response.numFound;if(count==0){if(!append){var msg="";if(_currentRadius>0){var btnText=_currentRadius>0?"Within "+_currentRadius+"KM":"All";msg="<p>Specials are currently confined to a radius of <b><u>"+_currentRadius+"km</u></b> from your <b><u>current location</u></b>. Expend the search radius by selecting the <b><u>'"+btnText+"'</u></b> button above.</p>"}$("#specials-list").html("<li class='loading'><h3>No specials found.</h3>"+msg+"</li>")}$.mobile.hidePageLoadingMsg();return}if((data.response.docs.length>0)&&(count>data.response.docs.length)){$(".more","#specials").html("<div>More</div>").show()}else{$(".more","#specials").hide()}var html="";for(var i=0;i<data.response.docs.length;i++){var item=data.response.docs[i];var img="";if(item.images&&item.images.length>0){var imageHeight=" height='64'";if($(window).width()>540){imageHeight=""}img='<img class="img" id="image-'+item.id+'" src="'+item.images[0]+'" align="right" width="100"'+imageHeight+">"}var excerpt="";if(item.excerpt&&typeof(item.excerpt)!="undefined"){excerpt=item.excerpt}var hdr='<h3><span class="title">'+item.name+"</span></h3>";if($(window).width()<540){hdr=img+hdr}else{hdr=hdr+img}var listingIds=item.listing_id.split(",");var listingId="";if($.isArray(listingIds)){if(listingIds.length>0){listingId=listingIds[0];Query.execute("http://api.safindit.co.za/v1/place/",1,0,listingId,[],function(data){if(data){if(data.response){var count=data.response.numFound;if(count>0){var place=data.response.docs[0];var $listing=$("div[data-listing-id="+place.id+"]","#specials-list");var listingsCount=$listing.attr("data-listings-count");var html="";if(listingsCount>1){html=" and "+(listingsCount-1)+" others"}if(listingsCount==2){html=" and 1 other"}$("div[data-listing-id="+place.id+"]","#specials-list").html(place.name+html)}}}})}}html+='<li class="article special" id="special-'+item.id+'"><a href="javascript:SAF.Specials.load('+item.id+')"><div class="article-inner"><div class="article-container'+(append===true?" new":"")+'">'+hdr+'<div data-listing-id="'+listingId+'" data-listings-count="'+listingIds.length+'" class="prop"></div><div class="prop">'+SAF.Special.getDateString(item.start_date,item.end_date)+'</div><div class="excerpt">'+excerpt+"</div></div></div></a></li>"}if(append){SAF.isotopeIt("#specials-list","li.article",true,html)}else{$("#specials-list").html(html);SAF.isotopeIt("#specials-list","li.article")}if($(window).width()>540){$("#specials-list").bind("isotope",function(event){var width=$("li.article:first","#specials-list").width();var columnCount=event.columnCount;var containerWidth=width*columnCount;if($(window).width()-containerWidth<200){$(".content-primary","#specials").width(containerWidth+10)}})}$(".article","#specials-list").each(function(){SAF.cleanElement($("span.title",this));SAF.cleanElement($("p.excerpt",this))})}}else{SAF.alertError("Error. Please try again.")}$.mobile.hidePageLoadingMsg()}return specials})(SAF.Specials||{});$(function(){SAF.Specials.init()});SAF.Specials.Filter=(function(filter){filter.init=function(){SAF.registerPage("specials-filter",this);$("ul[data-role=listview] a","#specials-filter").click(function(){var $this=$(this);var filterValue=$this.html();$.mobile.changePage("#specials",{reverse:true});if(filterValue=="All"){$("a[data-icon=saf_filter]","#specials").removeClass("selected");$("header h2","#specials").html("News")}else{$("a[data-icon=saf_filter]","#specials").addClass("selected");$("header h2","#specials").html(filterValue)}setTimeout(function(){SAF.Specials.filterByCategory(filterValue)},20)})};filter.back=function(){$.mobile.changePage("#specials",{reverse:true});setTimeout(function(){SAF.Specials.scroll()},20)};return filter})(SAF.Specials.Filter||{});$(function(){SAF.Specials.Filter.init()});SAF.Special=(function(special){var _baseAPIUrl="http://api.safindit.co.za/v1/special/";var _current=null;var _currentLocation="";var _backTo="specials";var _currentQuery="*";var _currentParams=[];var _currentPerPage=20;var _currentStart=0;var _scrollTop=0;special.init=function(){SAF.registerPage("special",this)};special.place=function(id){_scrollTop=$(window).scrollTop();SAF.Place.load(id,"special",_current.id)};special.more=function(){_currentStart=_currentStart+_currentPerPage;_loadListings(true)};special.back=function(){$.mobile.changePage("#"+_backTo,{reverse:true});setTimeout(function(){switch(_backTo){case"specials":SAF.Specials.scroll();break;case"favorites":SAF.Favorites.scroll();break}},20)};special.load=function(id,location,backTo){if(backTo){_backTo=backTo}if(location){_currentLocation=location}SAF.DB.saveState("special","view",id);$(".page-wrap","#special").hide();$.mobile.changePage("#special");setTimeout(function(){$.mobile.showPageLoadingMsg();Query.load(_baseAPIUrl+id,_populate)},20)};special.favorite=function(){if(_current){var item=_current;var excerpt="";if(typeof(item.excerpt)!="undefined"){excerpt=item.excerpt}var img="";if(item.images&&item.images.length>0){img=item.images[0]}SAF.DB.favoriteSpecial(item.id,item.name,excerpt,img,SAF.Special.getDateString(_current.start_date,_current.end_date),_currentLocation,_current.timestamp)}};special.unFavorite=function(){if(_current){SAF.DB.unFavoriteSpecial(_current.id)}};special.getDateString=function(startDate,endDate){startDate=formatDate(startDate);endDate=formatDate(endDate);var dateText="";if($.trim(startDate).length>0){dateText=startDate}if($.trim(endDate).length>0){if(endDate!=startDate){dateText=dateText+" to "+endDate}}return dateText};special.share=function(){if(_current){var item=_current;var desc="";if(typeof(item.listing_description)!="undefined"){desc=item.listing_description}SAF.Share.share(item.name,desc,"http://www.safindit.co.za/specials/"+item.slug,function(){$.mobile.changePage("#special",{reverse:true})})}};special.scroll=function(){SAF.scroll(_scrollTop)};var _imageState="";special.resize=function(){if($(window).width()<540){if(_imageState!="narrow"){_imageState="narrow";$("img.img","#special-places-list").removeAttr("height")}}else{_imageState="wide"}SAF.resizeIsotope("#special-places-list","li.place")};function _populate(data){if(data){if(data.response){var count=data.response.numFound;if(count==1){var item=data.response.docs[0];_current=item;SAF.DB.isFavoriteSpecial(item.id,function(result){if(result){$("#special a[data-icon=favorite]").addClass("selected")}else{$("#special a[data-icon=favorite]").removeClass("selected")}});if(typeof(item.listing_id)!="undefined"){$("span.count","#special").html("Where");_loadListings(false)}else{$("#special-places-list").html("<li class='loading'><h3>No places found for special.</h3></li>");$.mobile.hidePageLoadingMsg()}var dates=$.trim(SAF.Special.getDateString(item.start_date,item.end_date));if(dates.length>0){dates="<b>Validity:</b>&nbsp;"+dates}$("h1.main_title","#special").html(item.name);$(".description","#special").html(item.listing_description||"");var redeem="<div>"+dates+"</div>";if(item.to_redeem){redeem+='<div><b>How to Redeem:</b>&nbsp;<span class="redeem">'+item.to_redeem+"</span></div>"}$(".details","#special").html(redeem);_populateTags(item);SAF.cleanElement($("h1.main_title","#special"));$("a","#special .description").attr("target","_blank");$("iframe","#special .description").remove();$("object","#special .description").remove();$(".redeem","#special").html($(".redeem","#special").text());$("#special .description").html(SAF.cleanHTML($("#special .description").html()))}else{$("#special-content").html("<li class='loading'><h3>Special not found.</h3></li>")}}}$(".page-wrap","#special").show();$.mobile.hidePageLoadingMsg()}function _populateTags(item){if(item.tags&&item.tags.length>0){var tagHtml="";for(var i=0;i<item.tags.length;i++){tagHtml+="<div>"+item.tags[i]+"</div>"}$("div.tags","#special").parents(".page-content").first().show();$("div.tags","#special").html(tagHtml)}else{$("div.tags","#special").parents(".page-content").first().hide()}}function _loadListings(append){if(_current){$.mobile.showPageLoadingMsg();var callback=append===true?function(data){_populateListings(data,true)}:_populateListings;_currentParams=Query.mergeParams([{key:"sort",value:"hottest"},{key:"specialID",value:_current.id}],_currentParams);Query.execute("http://api.safindit.co.za/v1/place/search/",_currentPerPage,_currentStart,_currentQuery,_currentParams,callback)}}function _populateListings(data,append){if(data){if(data.response){var count=data.response.numFound;if(count==0){if(!append){$("#special-places-list").empty()}$.mobile.hidePageLoadingMsg();return}if((data.response.docs.length>0)&&(count>data.response.docs.length)){$(".more","#special").html("<div>More</div>").show()}else{$(".more","#special").hide()}_populateListingsList(data,append)}}else{SAF.alertError("Error. Please try again.")}$.mobile.hidePageLoadingMsg()}function _populateListingsList(data,append){var html="";for(var i=0;i<data.response.docs.length;i++){var item=data.response.docs[i];var img="";if(item.images&&item.images.length>0){var imageHeight=" height='64px'";if($(window).width()>540){imageHeight=""}img='<img class="img" id="image-'+item.id+'" src="'+item.images[0]+'" align="right" width="100"'+imageHeight+'">'}var excerpt="";if(typeof(item.excerpt)!="undefined"){excerpt=item.excerpt}var email="";if(typeof(item.email)!="undefined"){email='<div class="prop"><a href="mailto:'+item.email+'">'+item.email+"</a></div>"}var tel="";if(typeof(item.contact)!="undefined"){tel='<div class="prop"><a href="tel:'+item.contact.replace("+27","").replace("(","").replace(")","")+'">'+item.contact+"</a></div>"}var addr="";if(typeof(item.address)!="undefined"){addr='<div class="prop">'+item.address+"</div>"}var first="";if(i==0){first=" first"}if(i==data.response.docs.length-1){first=" last"}var hdr='<h3><span class="title">'+item.name+"</span></h3>";if($(window).width()<540){hdr=img+hdr}else{hdr=hdr+img}html+='<li class="place'+first+'"><a href="javascript:SAF.Special.place('+item.id+')"><div class="place-inner"><div class="place-container'+(append===true?" new":"")+'">'+hdr+'<div class="excerpt">'+excerpt+'</div></div><div class="meta-container">'+tel+email+addr+"</div></div></a></li>"}if(append){SAF.isotopeIt("#special-places-list","li.place",true,html)}else{$("#special-places-list").html(html);SAF.isotopeIt("#special-places-list","li.place")}if($(window).width()>540){$("#special-places-list").bind("isotope",function(event){var width=$("li.place:first","#special-places-list").width();var columnCount=event.columnCount;var containerWidth=width*columnCount;if($(window).width()-containerWidth<200){$(".content-primary","#special").width(containerWidth+10)}})}$(".place","#special-places-list").each(function(){SAF.cleanElement($("span.title",this));SAF.cleanElement($(".excerpt",this))});$.mobile.hidePageLoadingMsg()}return special})(SAF.Special||{});$(function(){SAF.Special.init()});SAF.Share=(function(share){var _current={title:"",description:"",url:"",callback:function(){}};share.init=function(){SAF.registerPage("share",this)};share.share=function(title,description,url,callback){_current.title=title;_current.description=description;_current.url=url;_current.callback=callback;$.mobile.changePage("#share");$("#share-url").val(url)};share.launch=function(){window.open(_current.url);_current.callback()};share.mail=function(){var link="mailto:?subject="+encodeURIComponent(_current.title)+"&body="+encodeURIComponent("<p><a href='"+_current.url+"'>"+_current.title+"</a></p>"+_current.description+"<p>Sent via <a href='http://m.safindit.co.za'>Safindit Mobile</a></p>");window.open(link);_current.callback()};share.tweet=function(){var url=_current.url;var encodedUrl=encodeURIComponent(url);var encodedTitle=encodeURIComponent(_current.title.substr(0,100));var tweetUrl="http://twitter.com/share?url="+encodedUrl+"&text="+encodedTitle+"&via=safindit";window.open(tweetUrl);_current.callback()};share.facebook=function(){var encodedUrl=encodeURIComponent(_current.url);var encodedTitle=encodeURIComponent(_current.title);var shareUrl="http://m.facebook.com/sharer.php?t="+encodedTitle+"&u="+encodedUrl;window.open(shareUrl);_current.callback()};share.back=function(){_current.callback()};return share})(SAF.Share||{});$(function(){SAF.Share.init()});